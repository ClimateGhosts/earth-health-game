(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[405],{8312:function(e,a,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/",function(){return t(7149)}])},7149:function(e,a,t){"use strict";t.r(a),t.d(a,{default:function(){return pages}});var r,n,o,l,i,c,m=t(5893),d=t(7294),h=t(5005),u=t(8837),x=t(1555),p=t(682),j=t(4247),g=t(4490),y=t(2960),_=t(2749),v=t(4486),N=t(2914),b=t(7017),Z=t(4051),f=t(2599),E=t(8817),w=t(1978),F=t(1143),C=t(1515),k=t(5386),O=t(6486),A=t.n(O),T=t(9578),R=t(9019),S=t(5378);let I=(0,d.createContext)({socket:void 0,serverUrl:"https://earth-health-game.appmana.com",isConnected:!1,myRoles:[]}),createSocket=e=>{let a=(0,f.io)(e);return a.url=e,a},SocketIOCommon=e=>{let{children:a,title:t}=e,[r,n]=(0,E.Z)("serverUrl","https://earth-health-game.appmana.com"),[o,l]=(0,d.useState)(()=>createSocket(r)),[i,c]=(0,d.useState)(null),[f,O]=(0,E.Z)("username","Client"),[T,R]=(0,d.useState)([]),[S,G]=(0,w.Z)(new Set([])),[D,L]=(0,d.useState)(!1),[M,B]=(0,d.useState)(""),[H,P]=(0,d.useState)([]),[W,z]=(0,F.Z)({}),randomRoomId=()=>Math.round(new Date().getMilliseconds()).toString(),[U,Y]=(0,d.useState)(randomRoomId()),[X,q]=(0,C.Z)([]),J=X.find(e=>e.players.some(e=>e.sid===M)),K=!!J;(0,d.useEffect)(()=>(setTimeout(()=>{o.connected||c(!1)},2e3),q.clear(),o.on("connect",()=>{c(!0),console.log("Client Connected"),o.emit("list_roles",{},e=>{let{roles:a}=e;R(a)}),o.emit("list_rooms",{},e=>{let{rooms:a}=e;q.set(a)}),o.emit("info",{},e=>{console.log(e)}),o.emit("list_options",{},e=>{let{options:a}=e;P(a),z.setAll(Object.fromEntries(a.map(e=>[e.name,e.default])))})}),o.on("disconnect",()=>{c(!1),q.clear(),console.log("Client Disconnected")}),o.on("your_sid",e=>{let{sid:a}=e;B(a)}),o.onAny((e,a)=>{console.log(e,a)}),o.on("game_started",()=>{L(!0)}),o.on("room_changed",e=>{q.update(a=>a.room==e.room,e)}),o.on("room_created",e=>{let{room:a,owner_sid:t}=e;q.push({room:a,owner:t,in_game:!1,players:[]})}),o.on("room_deleted",e=>{let{room:a}=e;q.filter((e,t,r)=>e.room!=a)}),()=>{o.disconnect(),o.close()}),[o]),(0,k.Z)(()=>{r!==o.url&&(o.connected&&o.disconnect(),o.close(),c(null),l(createSocket(r)))},1e3,[r]),(0,k.Z)(()=>{(null==o?void 0:o.connected)&&o.emit("set_roles",{roles:[...S]})},500,[S]),(0,k.Z)(()=>{f&&(null==o?void 0:o.connected)&&o.emit("set_name",{name:f})},500,[f]);let[V,$]=(0,d.useState)(""),[Q,ee]=(0,d.useState)("");return(0,m.jsxs)(m.Fragment,{children:[D||(0,m.jsxs)(p.Z,{children:[t&&(0,m.jsx)("h1",{className:"text-center m-2",children:t}),(0,m.jsxs)(Z.Z,{className:"align-items-center m-2 g-3 justify-content-center",children:[(0,m.jsxs)(x.Z,{md:4,children:[(0,m.jsx)(N.Z.Label,{children:"Server URL"}),(0,m.jsxs)("div",{className:"position-relative",children:[(0,m.jsx)(N.Z.Control,{type:"text",placeholder:"Enter server URL",value:r,onChange:e=>n(e.target.value)}),(0,m.jsx)("div",{className:"end-0 position-absolute absolute-centered-y me-2",children:(0,m.jsx)(Indicator,{status:(null==o?void 0:o.url)===r?i:null})})]})]}),(0,m.jsxs)(x.Z,{md:2,children:[(0,m.jsx)(N.Z.Label,{children:"Username"}),(0,m.jsx)(N.Z.Control,{type:"text",placeholder:"Enter username",value:f,onChange:e=>O(e.target.value),maxLength:23})]})]}),(0,m.jsx)("h3",{className:"text-center my-3",children:"Rooms"}),(0,m.jsxs)(Z.Z,{className:"g-3 justify-content-center",children:[X.map(e=>{let a=e.players.some(e=>e.sid===M),t=e.owner===M;return(0,m.jsx)(x.Z,{md:4,children:(0,m.jsxs)(u.Z,{className:"text-center p-3 d-flex flex-column h-100 shadow-sm justify-content-between",children:[(0,m.jsxs)("h5",{children:["#",e.room]}),e.players.map(e=>(0,m.jsxs)("div",{className:"d-flex justify-content-center align-items-center my-2",children:[e.name,e.sid===M?(0,m.jsxs)(j.Z,{autoClose:"outside",className:"ms-2",children:[(0,m.jsx)(v.Z,{size:"sm",className:"text-wrap",children:[...S].sort().map(e=>T[e].name).join(", ")||"No Roles"}),(0,m.jsx)(_.Z,{className:"py-0",children:T.map((e,a)=>(0,m.jsxs)(g.Z,{active:G.has(a),className:"my-2 rounded-2",onClick:()=>G.has(a)?G.remove(a):G.add(a),children:[e.name," (min ",e.min,", max ",e.max,")"]},a))})]}):(0,m.jsxs)(m.Fragment,{children:[" ","(",e.roles.sort().map(e=>T[e].name).join(", ")||"No Roles",")"]})]},e.name)),!a&&(0,m.jsx)(h.Z,{size:"sm",className:"w-50 mt-3 mx-auto",variant:"primary",onClick:()=>{o.emit("join_room",{room:e.room,username:f||null}),o.emit("set_roles",{roles:[...S]})},disabled:e.in_game,children:e.in_game?"In Game":"Join"}),a&&(0,m.jsx)(h.Z,{size:"sm",className:"w-50 mt-3 mx-auto",variant:"danger",onClick:()=>o.emit("leave_room",{}),children:"Leave"}),t&&a&&(0,m.jsxs)(m.Fragment,{children:[(0,m.jsx)(h.Z,{size:"sm",className:"w-50 mt-3 mx-auto",variant:"success",onClick:()=>{console.log(W),o.emit("set_roles",{roles:[...S]}),o.emit("start_game",{args:{...W,players:A().chain(e.players).flatMap(e=>e.roles).uniq().value().length}},function(){let{error:e}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};e&&($(A().startCase(e.type)),ee(e.message||""))})},children:"Start Game"}),(null==H?void 0:H.length)&&(0,m.jsxs)(j.Z,{className:"mt-3",autoClose:"outside",children:[(0,m.jsx)(v.Z,{size:"sm",variant:"outline-primary",className:"border-0 text-body",children:"Options"}),(0,m.jsx)(_.Z,{children:H.filter(e=>!!e.description).map((e,a)=>(0,m.jsx)(y.Z,{children:(0,m.jsxs)(Z.Z,{className:"row-cols-2",children:[(0,m.jsx)(x.Z,{xs:"auto",className:"me-auto d-flex align-items-center",children:e.name}),(0,m.jsx)(x.Z,{xs:"auto",children:"bool"===e.type?(0,m.jsx)(h.Z,{size:"sm",variant:!0==z.get(e.name)?"success":"danger",onClick:()=>z.set(e.name,!z.get(e.name)),children:!0==z.get(e.name)?"True":"False"}):(0,m.jsx)(N.Z.Control,{size:"sm",className:"w-50 ms-auto",value:String(z.get(e.name)),type:"str"===e.type?"text":"number",onChange:a=>z.set(e.name,getOptionValue(e,a.target.value))})}),(0,m.jsx)(x.Z,{xs:"auto",className:"text-black-50",children:e.description})]})},a))})]})]}),0===e.players.length&&(0,m.jsx)(h.Z,{size:"sm",className:"w-50 mt-3 mx-auto",variant:"danger",onClick:()=>o.emit("delete_room",{room:e.room}),children:"Delete"})]})},e.room)}),!K&&(0,m.jsx)(x.Z,{md:4,className:"text-center",children:(0,m.jsxs)("div",{className:"text-center p-3 d-flex flex-column h-100 justify-content-between",children:[(0,m.jsx)(N.Z.Label,{children:"Room ID"}),(0,m.jsx)(N.Z.Control,{className:"w-25 mx-auto mb-3 text-center",type:"text",placeholder:"Room ID",value:U,onChange:e=>Y(e.target.value),maxLength:4}),(0,m.jsx)(h.Z,{className:"w-50 mx-auto",size:"sm",variant:"primary",onClick:()=>{o.emit("create_room",{room:U}),o.emit("join_room",{room:U,username:f||"Client"}),Y(randomRoomId())},disabled:!0!==i||K,children:"Create"})]})})]})]}),(0,m.jsx)(I.Provider,{value:{socket:o,serverUrl:r,isConnected:i,roleInfo:T,currentRoom:J,myRoles:[...S],leaveGame:()=>{L(!1),G.reset(),o.emit("leave_room",{})}},children:a}),(0,m.jsxs)(b.Z,{show:!!Q,onHide:()=>ee(""),children:[(0,m.jsx)(b.Z.Header,{closeButton:!0,children:(0,m.jsx)(b.Z.Title,{children:V||"Error"})}),(0,m.jsx)(b.Z.Body,{children:(0,m.jsx)("p",{children:Q})})]})]})},Indicator=e=>{let{status:a}=e;return!0===a?(0,m.jsx)(T.Z,{color:"green"}):!1===a?(0,m.jsx)(R.Z,{color:"red"}):(0,m.jsx)(S.Z,{color:"orange"})},getOptionValue=(e,a)=>{switch(e.type){case"str":return String(a);case"bool":return!!a;case"int":return"string"==typeof a?parseInt(a):Number(a);case"float":return"string"==typeof a?parseFloat(a):Number(a)}};var G=t(7176),D=t(9517),L=t(3489);(r=l||(l={}))[r.EXPLOIT=0]="EXPLOIT",r[r.HEAL=1]="HEAL",r[r.FOREIGN_AID=2]="FOREIGN_AID",r[r.CLIMATE_GHOST=3]="CLIMATE_GHOST",r[r.END_TURN=4]="END_TURN",r[r.RENAME_REGION=5]="RENAME_REGION";var M=t(7769),B=t(1711),H=t(3967),P=t.n(H),W=t(619),z=t(9591),disaster_entry=e=>{let{disaster:a,state:t,nameForPlayer:r}=e,n=null==t?void 0:t.world.regions[a.region_id];return(0,m.jsxs)(m.Fragment,{children:[et.disaster[a.disaster].emoji,a.disaster,a.damage&&(0,m.jsxs)(m.Fragment,{children:[" ","dealt"," ",(0,m.jsxs)("span",{style:{color:colorForDamage(a.damage)},children:[a.damage," damage"]})]}),n&&(0,m.jsxs)(m.Fragment,{children:[" ","in ",et.biome[n.biome].emoji,n.name,n.health<=0&&" (DESTROYED\uD83D\uDC80)",r&&(0,m.jsxs)(m.Fragment,{children:[" for ",r(a.current_owner)]})]})]})};let colorForDamage=e=>(0,z.ZP)("black",e>4?"red":"green")(Math.min((1+Math.abs(4-e))/3,1)),s=e=>"".concat(e>=0?"+":"").concat(e);var selected_region_panel=e=>{var a,t;let{className:r}=e,{socket:n,myRoles:o}=(0,d.useContext)(I),{state:i,currentRegion:c,selectedRegion:p,currentPlayer:j,myTurn:g,operators:y,nameForPlayer:_,gameOver:v}=(0,d.useContext)(ea),[N]=(0,W.Z)("/earth-health-game/audio/EarthHealthExploit.mp3"),[b]=(0,W.Z)("/earth-health-game/audio/EarthHealthHeal.mp3"),f=et.biome[null!==(a=null==c?void 0:c.biome)&&void 0!==a?a:""],E=Object.values(null!==(t=null==c?void 0:c.devastation_history)&&void 0!==t?t:{}).flat();return c&&(0,m.jsx)(u.Z,{className:P()("shadow-lg w-25 p-3 overflow-y-auto  pointer-events-auto",r),style:{maxHeight:"70vh"},children:(0,m.jsxs)(Z.Z,{className:"row-cols-1 g-3",children:[(0,m.jsxs)(x.Z,{className:"text-center",children:[(0,m.jsxs)("h2",{className:"mb-3",children:[c.name,o.includes(c.current_player)&&(0,m.jsx)(h.Z,{size:"sm",variant:"outline-primary",className:"border-0",onClick:()=>{let e=prompt("Choose a new name for this region",c.name);e&&e!==c.name&&n.emit("operator_chosen",{op_no:l.RENAME_REGION,params:[c.id,e]})},children:(0,m.jsx)(M.Z,{})})]}),(0,m.jsxs)(Z.Z,{className:"fs-5 g-2 row-cols-2",children:[c.health>0&&(0,m.jsxs)(x.Z,{children:["Owned by: ",_(c.current_player)]}),(0,m.jsxs)(x.Z,{children:["Biome: ",c.biome,et.biome[c.biome].emoji]}),(0,m.jsxs)(x.Z,{children:["Health: ",c.health>0?"".concat(c.health,"❤️"):"\uD83D\uDC80"]})]})]}),(0,m.jsxs)(x.Z,{className:"text-center",children:[(0,m.jsx)("h3",{className:"mb-3",children:"Disaster History"}),(0,m.jsx)(Z.Z,{className:"row-cols-1 g-3 justify-content-center",children:E.length>0?Object.entries(c.devastation_history).map(e=>{let[a,t]=e;return(0,m.jsx)(d.Fragment,{children:t.map((e,t)=>(0,m.jsxs)(x.Z,{children:[displayTime(parseInt(a)),": ",(0,m.jsx)(disaster_entry,{disaster:e})]},t))},a)}):(0,m.jsx)(x.Z,{children:"No disasters have hit this region yet."})})]}),c.current_player>=0&&(0,m.jsxs)(x.Z,{className:"text-center",children:[(0,m.jsx)("h3",{className:"mb-3",children:"Disaster Affinity"}),(0,m.jsx)(Z.Z,{className:"row-cols-2 g-2",children:et.disasters.map(e=>{var a,t,r;let n=e.damage,o=["".concat(n," base damage")],l=null!==(a=f.disaster_matrix[e.name])&&void 0!==a?a:0;for(let a of(n+=l,o.push("".concat(s(l)," from ").concat(f.emoji).concat(f.name)),E)){let l=et.disaster[a.disaster],i=null!==(r=null===(t=l.disaster_matrix)||void 0===t?void 0:t[e.name])&&void 0!==r?r:0;n+=i,0!==i&&o.push("".concat(s(i)," from prior ").concat(l.emoji).concat(l.name))}return o.push("= ".concat(n," total damage")),(0,m.jsxs)(x.Z,{className:"d-flex flex-row justify-content-center align-items-center",children:[e.emoji,e.name,":",(0,m.jsxs)("span",{className:"mx-1",style:{color:colorForDamage(n)},children:[n," damage"]}),(0,m.jsx)(D.Z,{overlay:(0,m.jsx)(L.Z,{children:o.map((e,a)=>(0,m.jsx)("div",{children:e},a))}),children:(0,m.jsx)(B.Z,{className:"text-muted"})})]},e.name)})})]}),!v&&c.current_player>=0&&(0,m.jsxs)(x.Z,{children:[(0,m.jsx)("h3",{className:"text-center mb-3",children:"Actions"}),(0,m.jsxs)(Z.Z,{className:"row-cols-1 g-3 justify-content-center",children:[!g&&(0,m.jsx)(x.Z,{children:"Not your turn."}),c.id in j.current_actions?(0,m.jsx)(x.Z,{children:"Already taken action this turn."}):(0,m.jsx)(m.Fragment,{children:y.filter(e=>{switch(e.op_no){case l.EXPLOIT:case l.HEAL:return c.current_player==i.current_player;case l.FOREIGN_AID:return c.health>0&&c.current_player!==i.current_player;default:return!1}}).map(e=>(0,m.jsx)(x.Z,{xs:"auto",children:(0,m.jsx)(h.Z,{onClick:()=>{switch(n.emit("operator_chosen",{op_no:e.op_no,params:[p]}),e.op_no){case l.HEAL:b();break;case l.EXPLOIT:N()}},children:e.name})}))})]})]})]})})},end_turn_panel=e=>{let{className:a}=e,{socket:t,leaveGame:r}=(0,d.useContext)(I),{state:n,currentPlayer:o,operators:i,nameForPlayer:c,gameOver:x}=(0,d.useContext)(ea),p=i.find(e=>e.op_no===l.CLIMATE_GHOST);return(0,m.jsx)(u.Z,{className:P()("shadow-lg w-auto p-3",a),children:(0,m.jsx)("h3",{className:"text-center pointer-events-auto",children:x?(0,m.jsxs)(m.Fragment,{children:[(0,m.jsx)("div",{children:"The Game Is Over!"}),(0,m.jsx)(h.Z,{className:"mt-3 w-100",onClick:()=>null==r?void 0:r(),children:"Return Home"})]}):i.length>0?(0,m.jsxs)(m.Fragment,{children:[(0,m.jsx)("div",{children:"It is your turn."}),p&&(0,m.jsx)(h.Z,{className:"mt-3 w-100",variant:"warning",onClick:()=>t.emit("operator_chosen",{op_no:l.CLIMATE_GHOST,params:null}),children:p.name}),(0,m.jsx)(h.Z,{className:"mt-3 w-100",variant:n.world.regions.some(e=>e.current_player===n.current_player&&!(e.id in o.current_actions))?"primary":"success",onClick:()=>t.emit("operator_chosen",{op_no:l.END_TURN,params:null}),children:"End Turn"})]}):"".concat(c(n.current_player)," is acting.")})})};(n=i||(i={})).RED="#C0392B",n.GREEN="#27AE60",n.YELLOW="#F1C40F",n.BLUE="#2980B9",n.MAGENTA="#8E44AD",n.CYAN="#17C4C4",n.WHITE="#ECF0F1",n.ORANGE="#E67E22",n.PURPLE="#9B59B6";let biomeColor=e=>i[et.biome[e].color],playerColor=e=>i[et.player_colors[e]];var U=t(5472),Y=t.n(U);let ClimateBadness=e=>{let{badness:a}=e,t="Moderate";return a>=10&&(t="Bad"),a>=15&&(t="Terrible"),a>=20&&(t="Apocalyptic"),(0,m.jsxs)(m.Fragment,{children:["Climate Severity: ",t]})};var state_info_panel=e=>{let{className:a}=e,{myRoles:t}=(0,d.useContext)(I),{state:r,nameForPlayer:n}=(0,d.useContext)(ea);return(0,m.jsxs)(u.Z,{className:P()("shadow-lg w-25 p-3 overflow-y-auto pointer-events-auto",a),style:{maxHeight:"80vh"},children:[(0,m.jsx)("h3",{className:"text-center",children:"State Info"}),(0,m.jsxs)(Z.Z,{className:"row-cols-1 g-2",children:[(0,m.jsxs)(x.Z,{children:["Time: ",displayTime(r.time)," (playing until ",displayTime(r.final_turn),")"]}),(0,m.jsx)(x.Z,{children:(0,m.jsx)(ClimateBadness,{badness:r.global_badness})})]}),r.players.some(e=>t.includes(e.player_id)&&e.regions_owned<=0)&&(0,m.jsxs)(m.Fragment,{children:[(0,m.jsx)("h3",{className:"text-center my-3",children:"Next Possible Disasters"}),(0,m.jsx)(Z.Z,{className:"row-cols-1 g-3",children:r.disaster_buffer.map((e,a)=>(0,m.jsx)(x.Z,{children:(0,m.jsx)(disaster_entry,{disaster:e,state:r,nameForPlayer:n})},a))})]}),(0,m.jsx)("h3",{className:"text-center my-3",children:"Player Info"}),(0,m.jsx)(Z.Z,{className:"row-cols-1 g-3",children:Y()(r.players,e=>!t.includes(e.player_id)).map(e=>(0,m.jsx)(x.Z,{children:(0,m.jsx)(Z.Z,{className:"row-cols-1 p-2 g-2 rounded-2",style:{border:".5rem ".concat(playerColor(e.player_id)," solid")},children:e.regions_owned>0?(0,m.jsxs)(m.Fragment,{children:[(0,m.jsxs)(x.Z,{children:[n(e.player_id),": ",displayMoney(e.money)]}),Object.values(r.world.regions).filter(a=>a.current_player===e.player_id).map((e,a)=>(0,m.jsxs)(x.Z,{className:"ms-4",children:[e.name," (",e.biome,et.biome[e.biome].emoji,", ",e.health,"❤️)"]},a))]}):(0,m.jsxs)(m.Fragment,{children:[n(e.player_id)," \uD83D\uDC7B"]})})},e.player_id))})]})};(o=c||(c={})).ByOwner="By Owner",o.ByBiome="By Biome",o.ByHealth="By Health";var visual_options_panel=e=>{let{className:a}=e,{options:{colorMode:t,setColorMode:r}}=(0,d.useContext)(ea);return(0,m.jsx)(u.Z,{className:P()("position-absolute shadow-lg w-auto p-3",a),children:(0,m.jsx)(Z.Z,{className:"row-cols-1 g-3 pointer-events-auto",children:(0,m.jsxs)(x.Z,{className:"d-flex flex-row align-items-center",children:[(0,m.jsx)("span",{className:"me-3",children:"Region Color Mode"}),(0,m.jsxs)(j.Z,{children:[(0,m.jsx)(v.Z,{size:"sm",children:t}),(0,m.jsx)(_.Z,{children:Object.values(c).map(e=>(0,m.jsx)(g.Z,{active:e===t,onClick:()=>r(e),children:e},e))})]})]})})})},transitions_model=e=>{let{body:a,title:t,onHide:r}=e;return(0,m.jsxs)(b.Z,{size:"lg",show:!!a,onHide:r,backdrop:"static",className:"user-select-none",children:[(0,m.jsx)(b.Z.Header,{closeButton:!0,children:(0,m.jsx)(b.Z.Title,{children:t})}),(0,m.jsx)(b.Z.Body,{children:a})]})},X=t(7172),q=t(6409),J=t(5929),region_geography=e=>{let{geo:a}=e,{state:t,selectedRegion:r,setSelectedRegion:n,myTurn:o,currentPlayer:l,options:{colorMode:h}}=(0,d.useContext)(ea),u=regionForGeo(a,t),x="#666";if(u.health>0)switch(h){case c.ByBiome:x=biomeColor(u.biome);break;case c.ByOwner:x=playerColor(u.current_player);break;case c.ByHealth:x=(0,J.Z)(i.RED,i.GREEN)(u.health/10)}let p=u.id===r,j=o&&u.current_player===t.current_player&&!(u.id in l.current_actions)&&u.health>0;return(0,m.jsx)(X.Geography,{geography:a,fill:x,style:{default:{stroke:p?"#FFF":j?"#0F0":"#666",strokeWidth:1,outline:"none"},hover:{stroke:p?"#FFF":j?"#0F0":"#666",strokeWidth:1,fill:(0,z.ZP)(x,"#FFF")(.2),outline:"none"}},onClick:e=>{e.stopPropagation(),n(p?-1:u.id)}})},K=t(8540),region_marker=e=>{let{geo:a}=e,{state:t}=(0,d.useContext)(ea),r=regionForGeo(a,t),n=(0,K.Z)(a);return(0,m.jsxs)(X.Marker,{coordinates:n,className:"pointer-events-none",children:[(0,m.jsx)("text",{textAnchor:"middle",y:-8,style:{fontFamily:"system-ui",fontWeight:"bold",fontSize:5,fill:"#000"},stroke:"#FFF",strokeWidth:.2,children:Object.values(r.devastation_history).flat().map(e=>et.disaster[e.disaster].emoji)}),(0,m.jsx)("text",{textAnchor:"middle",y:-2,style:{fontFamily:"system-ui",fontWeight:"bold",fontSize:5,fill:"#000"},stroke:"#FFF",strokeWidth:.2,children:r.name}),(0,m.jsx)("text",{textAnchor:"middle",y:4,style:{fontFamily:"system-ui",fontWeight:"bold",fontSize:5,fill:"#000"},stroke:"#FFF",strokeWidth:.2,children:r.health>0?(0,m.jsxs)(m.Fragment,{children:[r.health,"❤️",et.biome[r.biome].emoji]}):(0,m.jsx)(m.Fragment,{children:"\uD83D\uDC80"})})]})};let regionForGeo=(e,a)=>{let t=parseInt(e.rsmKey.replace("geo-",""));return a.world.regions[t]};var game_map=()=>{let e=(0,q.g)()||1e3,{state:a,currentPlayer:t,selectedRegion:r,setSelectedRegion:n}=(0,d.useContext)(ea),reorderGeos=e=>A().chain(e).filter((e,t)=>t<a.world.region_count).orderBy([e=>regionForGeo(e,a).id===r,e=>regionForGeo(e,a).current_player===a.current_player,e=>!(regionForGeo(e,a).id in t.current_actions)]).value();return(0,m.jsx)(X.ComposableMap,{height:1e3,width:2e3,style:{background:i.BLUE,height:e,width:"100%"},onClick:()=>n(-1),children:(0,m.jsx)(X.ZoomableGroup,{zoom:4,minZoom:3,translateExtent:[[600,300],[1300,700]],children:(0,m.jsx)(X.Geographies,{geography:"/earth-health-game/map.geo.json",children:e=>{let{geographies:a}=e,t=reorderGeos(a);return t.map(e=>(0,m.jsx)(region_geography,{geo:e},e.rsmKey+"Geography")).concat(t.map(e=>(0,m.jsx)(region_marker,{geo:e},e.rsmKey+"Marker")))}})})})};let logMessageForOperator=(e,a,t)=>{let r="".concat(a," has ");switch(e.op_no){case l.EXPLOIT:case l.HEAL:case l.FOREIGN_AID:case l.RENAME_REGION:let n=t.world.regions[e.params[0]];switch(e.op_no){case l.EXPLOIT:r+="exploited ".concat(n.name,".");break;case l.HEAL:r+="healed ".concat(n.name,".");break;case l.FOREIGN_AID:r+="sent foreign aid to ".concat(n.name,".");break;case l.RENAME_REGION:r+="renamed ".concat(n.name," to ").concat(e.params[1],".")}break;case l.CLIMATE_GHOST:r+="has tipped the scales from beyond the grave.";break;case l.END_TURN:r+="ended their turn."}return r},logsForTransitions=(e,a)=>{let t=[];if(!e||e.time===a.time)return t;for(let e of a.devastations)t.push({time:a.time,message:"".concat(e.disaster," in ").concat(e.region," (").concat(e.damage," damage)")});for(let n of a.world.regions){var r;n.health<=0&&(null!==(r=null==e?void 0:e.world.regions[n.id].health)&&void 0!==r?r:0)>0&&t.push({time:a.time,message:"".concat(n.name," was destroyed!")})}return t};var game_log_panel=e=>{let{className:a,gameLogs:t}=e,[r,n]=(0,d.useState)(!1);return(0,m.jsxs)("div",{className:P()("w-50 h-25",a),children:[r&&(0,m.jsx)(u.Z,{className:"shadow-lg p-3 mb-5 h-100 overflow-y-scroll w-100 bottom-0 position-absolute d-flex flex-column-reverse pointer-events-auto",children:(0,m.jsx)("table",{children:Y()(t,e=>e.time).map((e,a)=>{let{time:t,message:r}=e;return(0,m.jsxs)("tr",{children:[(0,m.jsx)("td",{children:displayTime(t)}),(0,m.jsx)("td",{children:r})]},a)})})}),(0,m.jsx)(h.Z,{variant:"outline-dark",className:"border-0 fs-4 pointer-events-auto bottom-0 position-absolute absolute-centered-x",onClick:()=>n(!r),children:"Logs"})]})},V=JSON.parse('{"biomes":[{"name":"Ocean","color":"BLUE","playable":false,"emoji":"\uD83C\uDF0A","disaster_matrix":{"Earthquake":0,"Fire":0,"Flood":0,"Windstorm":0}},{"name":"Mountain","color":"CYAN","playable":true,"emoji":"⛰️","disaster_matrix":{"Earthquake":1,"Fire":-1,"Flood":-2,"Windstorm":2}},{"name":"Plains","color":"YELLOW","playable":true,"emoji":"\uD83C\uDF3E","disaster_matrix":{"Earthquake":-2,"Fire":1,"Flood":2,"Windstorm":-1}},{"name":"Woods","color":"GREEN","playable":true,"emoji":"\uD83C\uDF32","disaster_matrix":{"Earthquake":-1,"Fire":2,"Flood":1,"Windstorm":-2}},{"name":"Mesa","color":"RED","playable":true,"emoji":"\uD83C\uDFDC️","disaster_matrix":{"Earthquake":2,"Fire":-2,"Flood":-1,"Windstorm":1}}],"disasters":[{"name":"Earthquake","color":"GREEN","damage":4,"emoji":"\uD83E\uDEA8","disaster_matrix":{"Flood":1}},{"name":"Fire","color":"RED","damage":4,"emoji":"\uD83D\uDD25","disaster_matrix":{"Flood":-1,"Windstorm":1}},{"name":"Flood","color":"BLUE","damage":4,"emoji":"\uD83C\uDF0A","disaster_matrix":{"Fire":-1}},{"name":"Windstorm","color":"YELLOW","damage":4,"emoji":"\uD83C\uDF2A️","disaster_matrix":{"Earthquake":1}}],"player_colors":["RED","GREEN","MAGENTA","ORANGE","CYAN"],"adjacency":{"0":[6,7,12,14],"1":[3,5,18],"2":[19],"3":[1,5,8,13,16],"4":[8,15,16],"5":[1,3,13,17],"6":[0,7,12,15],"7":[0,6,10,13,14,15],"8":[3,4,10,13,15,16],"9":[19],"10":[7,8,13,15],"11":[16],"12":[0,6],"13":[3,5,7,8,10,14,17],"14":[0,7,13],"15":[4,6,7,8,10],"16":[3,4,8,11],"17":[5,13],"18":[1,19],"19":[2,9,18]},"names":["Nova Arcadia","Elysium","Astoria","Aetheria","Valoria","Xion","Seraphina","Atlantica","Zirvana","Avalon","Galadria","Mythos","Ytopia","Elysian Fields","Aurora","Celestia","Elympia","Excalibur","Aden","Arcadia"]}'),$=t(4350),Q=t.n($),menu_panel=e=>{let{className:a}=e,{leaveGame:t}=(0,d.useContext)(I);return(0,m.jsx)("div",{className:P()(a),children:(0,m.jsxs)(j.Z,{drop:"down-centered",className:"pointer-events-auto",children:[(0,m.jsx)(v.Z,{variant:"outline-dark",className:"border-0 fs-4 d-flex align-items-center",children:"Menu"}),(0,m.jsx)(_.Z,{children:(0,m.jsx)(g.Z,{onClick:()=>{confirm("Are you sure you want to leave? This will end the game for other players.")&&(null==t||t())},children:"Leave Game"})})]})})},ee=t(1966),es=t.n(ee),transition=e=>{let{prevState:a,newState:t,gameContext:r,socketContext:n}=e,{nameForPlayer:o}=r,{myRoles:l}=n,i=t.devastations.filter(e=>l.includes(a.world.regions[e.region_id].current_player)),c=es()(t.devastations,i);return(0,m.jsxs)(m.Fragment,{children:[(0,m.jsxs)("h4",{className:"mb-3",children:["Time has progressed from ",displayTime(a.time)," to ",displayTime(t.time)]}),(0,m.jsxs)("h5",{className:"mb-3",children:["You have spent ",displayMoney(10)," on upkeep"]}),0===t.devastations.length?(0,m.jsx)("h5",{className:"mb-3",children:"No Disasters Have Occurred!"}):(0,m.jsxs)(m.Fragment,{children:[(0,m.jsxs)("h5",{className:"mb-3",children:["Total Disasters: ",t.devastations.length]}),(0,m.jsxs)("h5",{className:"mb-3",children:[i.length," hit in your regions"]}),i.map(e=>(0,m.jsx)("p",{children:(0,m.jsx)(disaster_entry,{disaster:e,state:t})})),(0,m.jsxs)("h5",{className:"mb-3",children:[c.length," hit in other regions"]}),c.map(e=>(0,m.jsx)("p",{children:(0,m.jsx)(disaster_entry,{disaster:e,state:t,nameForPlayer:o})}))]})]})};t(8267);var game_over=e=>{let{state:a,gameContext:t,socketContext:r}=e,{nameForPlayer:n}=t,{myRoles:o}=r,l=a.players.filter(e=>e.regions_owned>0);return(0,m.jsxs)(m.Fragment,{children:[(0,m.jsxs)("h4",{className:"mb-4",children:["Total Remaining Players: ",l.length]}),(0,m.jsx)(Z.Z,{className:"row-cols-1 g-3",children:Y()(a.players,e=>!o.includes(e.player_id)).map(e=>e.regions_owned>0?(0,m.jsxs)(m.Fragment,{children:[(0,m.jsxs)(x.Z,{children:[n(e.player_id)," had ",displayMoney(e.money)," and"," ",e.regions_owned," remaining region(s)"]}),Object.values(a.world.regions).filter(a=>a.current_player===e.player_id).map((e,a)=>(0,m.jsxs)(x.Z,{className:"ms-4",children:[e.name," (",e.biome,et.biome[e.biome].emoji,", ",e.health,"❤️)"]},a))]}):(0,m.jsxs)(x.Z,{children:[n(e.player_id)," had ",e.regions_owned," remaining regions"]}))})]})};let displayTime=e=>2050+10*e,displayMoney=e=>"$".concat(e,"M"),ea=(0,d.createContext)(void 0),et={...V,biome:Q()(V.biomes,e=>e.name),disaster:Q()(V.disasters,e=>e.name)};var game=()=>{let e=(0,d.useContext)(I),{socket:a,currentRoom:t,roleInfo:r,myRoles:n}=e,[o,l]=(0,d.useState)(void 0),[i,h]=(0,d.useState)([]),[u,x]=(0,d.useState)(!1),[p,j]=(0,d.useState)(-1),[g,y]=(0,C.Z)([]),[_,v]=(0,C.Z)([]),[N,b]=(0,d.useState)(void 0),[Z,f]=(0,d.useState)(c.ByOwner),E=(0,d.useMemo)(()=>t&&r?r.map((e,a)=>{var r;return(null===(r=t.players.find(e=>e.roles.includes(a)))||void 0===r?void 0:r.name)||"Unknown"}):[],[t,r]),w=p<0||!o?void 0:o.world.regions[p],F=null==o?void 0:o.players[null==o?void 0:o.current_player],k=!!o&&n.includes(o.current_player),nameForPlayer=e=>{var a;return e<0?"Nobody":"".concat(null==r?void 0:null===(a=r[e])||void 0===a?void 0:a.name," (").concat(E[e],")")},[O]=(0,W.Z)("/earth-health-game/audio/EarthHealthTurnStart.mp3"),A=(0,G.Z)(o);(0,d.useEffect)(()=>{o&&(null==A?void 0:A.current_player)!==o.current_player&&n.includes(o.current_player)&&O(),o&&A&&o.time!==A.time&&y.push(o.time<o.final_turn?(0,m.jsx)(transition,{prevState:A,newState:o,gameContext:T,socketContext:e}):(0,m.jsx)(game_over,{state:o,gameContext:T,socketContext:e}))},[o,n]),(0,d.useEffect)(()=>{a&&(a.on("game_started",e=>{e.state&&(x(!1),l(JSON.parse(e.state)),_.push({time:0,message:"The game has started!"}))}),a.on("operators_available",e=>{h(e.operators)}),a.on("operator_applied",e=>{e.state&&l(a=>{var t,r;b({...e.operator,player:null!==(t=null==a?void 0:a.current_player)&&void 0!==t?t:0,time:null!==(r=null==a?void 0:a.time)&&void 0!==r?r:0});let n=JSON.parse(e.state);return v.push(...logsForTransitions(a,n)),n})}),a.on("transition",e=>{let{message:a}=e}),a.on("game_ended",()=>{x(!0)}),a.on("disconnect",()=>{o&&(alert("You have been disconnected from the server"),window.location.reload())}),a.on("room_left",e=>{let{username:a}=e;o&&(x(!0),y.push("".concat(a," has left the game! Reconnection has not yet been implemented, so unfortunately the game must end.")))}))},[a]),(0,d.useEffect)(()=>{N&&v.push({time:N.time,message:logMessageForOperator(N,nameForPlayer(N.player),o)})},[N]),(0,d.useEffect)(()=>{t||l(void 0)},[t]);let T={state:o,operators:i,namesByRole:E,selectedRegion:p,setSelectedRegion:j,currentRegion:w,currentPlayer:F,myTurn:k,nameForPlayer,gameOver:u,options:{colorMode:Z,setColorMode:f}};return(0,m.jsx)("div",{className:"h-auto user-select-none",children:o&&(0,m.jsx)(ea.Provider,{value:T,children:(0,m.jsxs)("div",{className:"overflow-hidden position-relative d-flex",children:[(0,m.jsx)(game_map,{}),(0,m.jsxs)("div",{className:"position-absolute w-100 h-100 pointer-events-none",children:[(0,m.jsx)(state_info_panel,{className:"position-absolute top-0 start-0 m-4"}),(0,m.jsx)(selected_region_panel,{className:"position-absolute top-0 end-0 m-4"}),(0,m.jsx)(end_turn_panel,{className:"position-absolute bottom-0 end-0 m-4"}),(0,m.jsx)(visual_options_panel,{className:"position-absolute bottom-0 start-0 m-4"}),(0,m.jsx)(game_log_panel,{className:"position-absolute bottom-0 absolute-centered-x m-4",gameLogs:_}),(0,m.jsx)(menu_panel,{className:"position-absolute top-0 absolute-centered-x m-4"}),(0,m.jsx)(transitions_model,{body:g.length>0?g[0]:void 0,title:u?"Game Over!":"Transition",onHide:()=>{y.removeAt(0)}})]})]})})})},pages=()=>(0,m.jsx)(m.Fragment,{children:(0,m.jsx)(SocketIOCommon,{title:"Collaborative Climate Contest",children:(0,m.jsx)(game,{})})})}},function(e){e.O(0,[774,662,96,888,179],function(){return e(e.s=8312)}),_N_E=e.O()}]);