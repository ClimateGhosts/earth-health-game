(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[405],{8312:function(e,n,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/",function(){return t(2256)}])},2256:function(e,n,t){"use strict";t.r(n),t.d(n,{default:function(){return pages}});var s,r,o,a,l,i,c,m,d,h,u=t(5893),x=t(7294),p=t(5005),j=t(8837),g=t(1555),y=t(682),_=t(9279),N=t(4490),Z=t(2749),v=t(4486),C=t(2914),E=t(4449),F=t(4051),w=t(2599),f=t(8817),O=t(4741),R=t(1515),D=t(5386),b=t(9578),S=t(9019),A=t(5378),indicator=e=>{let{status:n}=e;return!0===n?(0,u.jsx)(b.Z,{color:"green"}):!1===n?(0,u.jsx)(S.Z,{color:"red"}):(0,u.jsx)(A.Z,{color:"orange"})},k=t(6486),I=t.n(k);let T=(0,x.createContext)({serverUrl:"https://earth-health-game.appmana.com",isConnected:!1,myRoles:[]}),createSocket=e=>{let n=(0,w.io)(e);return n.url=e,n},SocketIOCommon=e=>{let{children:n,title:t}=e,[s,r]=(0,f.Z)("serverUrl","https://earth-health-game.appmana.com"),[o,a]=(0,x.useState)(()=>createSocket(s)),[l,i]=(0,x.useState)(null),[c,m]=(0,f.Z)("username","Client"),[d,h]=(0,x.useState)([]),[w,b]=(0,O.Z)(new Set([])),[S,A]=(0,x.useState)(!1),[k,B]=(0,x.useState)(""),randomRoomId=()=>Math.round(new Date().getMilliseconds()).toString(),[M,G]=(0,x.useState)(randomRoomId()),[P,U]=(0,R.Z)([]),W=P.find(e=>e.players.some(e=>e.sid===k)),L=!!W;(0,x.useEffect)(()=>(setTimeout(()=>{o.connected||i(!1)},2e3),U.clear(),o.on("connect",()=>{i(!0),console.log("Client Connected"),o.emit("list_roles",{},e=>{let{roles:n}=e;h(n)}),o.emit("list_rooms",{},e=>{let{rooms:n}=e;U.set(n)}),o.emit("info",{},e=>{console.log(e)})}),o.on("disconnect",()=>{i(!1),U.clear(),console.log("Client Disconnected")}),o.on("your_sid",e=>{let{sid:n}=e;B(n)}),o.onAny((e,n)=>{console.log(e,n)}),o.on("game_started",()=>{A(!0)}),o.on("room_changed",e=>{U.update(n=>n.room==e.room,e)}),o.on("room_created",e=>{let{room:n,owner_sid:t}=e;U.push({room:n,owner:t,in_game:!1,players:[]})}),o.on("room_deleted",e=>{let{room:n}=e;U.filter((e,t,s)=>e.room!=n)}),()=>{o.disconnect(),o.close()}),[o]),(0,D.Z)(()=>{s!==o.url&&(o.connected&&o.disconnect(),o.close(),i(null),a(createSocket(s)))},1e3,[s]),(0,D.Z)(()=>{(null==o?void 0:o.connected)&&o.emit("set_roles",{roles:[...w]})},500,[w]),(0,D.Z)(()=>{c&&(null==o?void 0:o.connected)&&o.emit("set_name",{name:c})},500,[c]);let[H,z]=(0,x.useState)(""),[K,J]=(0,x.useState)("");return(0,u.jsxs)(u.Fragment,{children:[S||(0,u.jsxs)(y.Z,{children:[t&&(0,u.jsx)("h1",{className:"text-center m-2",children:t}),(0,u.jsxs)(F.Z,{className:"align-items-center m-2 g-3 justify-content-center",children:[(0,u.jsxs)(g.Z,{md:4,children:[(0,u.jsx)(C.Z.Label,{children:"Server URL"}),(0,u.jsxs)("div",{className:"position-relative",children:[(0,u.jsx)(C.Z.Control,{type:"text",placeholder:"Enter server URL",value:s,onChange:e=>r(e.target.value)}),(0,u.jsx)("div",{className:"end-0 position-absolute absolute-centered-y me-2",children:(0,u.jsx)(indicator,{status:(null==o?void 0:o.url)===s?l:null})})]})]}),(0,u.jsxs)(g.Z,{md:2,children:[(0,u.jsx)(C.Z.Label,{children:"Username"}),(0,u.jsx)(C.Z.Control,{type:"text",placeholder:"Enter username",value:c,onChange:e=>m(e.target.value)})]})]}),(0,u.jsx)("h3",{className:"text-center my-3",children:"Rooms"}),(0,u.jsxs)(F.Z,{className:"g-3 justify-content-center",children:[P.map(e=>{let n=e.players.some(e=>e.sid===k),t=e.owner===k;return(0,u.jsx)(g.Z,{md:4,children:(0,u.jsxs)(j.Z,{className:"text-center p-3 d-flex flex-column h-100 shadow-sm justify-content-between",children:[(0,u.jsx)("h5",{children:e.room}),e.players.map(e=>(0,u.jsxs)("div",{className:"d-flex justify-content-center align-items-center my-2",children:[e.name,e.sid===k?(0,u.jsxs)(_.Z,{autoClose:"outside",className:"ms-2",children:[(0,u.jsx)(v.Z,{size:"sm",className:"text-wrap",children:[...w].sort().map(e=>d[e].name).join(", ")||"No Roles"}),(0,u.jsx)(Z.Z,{className:"py-0",children:d.map((e,n)=>(0,u.jsxs)(N.Z,{active:b.has(n),className:"my-2 rounded-2",onClick:()=>b.has(n)?b.remove(n):b.add(n),children:[e.name," (min ",e.min,", max ",e.max,")"]},n))})]}):(0,u.jsxs)(u.Fragment,{children:[" ","(",e.roles.sort().map(e=>d[e].name).join(", ")||"No Roles",")"]})]},e.name)),!n&&(0,u.jsx)(p.Z,{size:"sm",className:"w-50 mt-3 mx-auto",variant:"primary",onClick:()=>{o.emit("join_room",{room:e.room,username:c||null}),o.emit("set_roles",{roles:[...w]})},disabled:e.in_game,children:e.in_game?"In Game":"Join"}),n&&(0,u.jsx)(p.Z,{size:"sm",className:"w-50 mt-3 mx-auto",variant:"danger",onClick:()=>o.emit("leave_room",{}),children:"Leave"}),t&&n&&(0,u.jsx)(p.Z,{size:"sm",className:"w-50 mt-3 mx-auto",variant:"success",onClick:()=>{o.emit("set_roles",{roles:[...w]}),o.emit("start_game",{args:{players:I().chain(e.players).flatMap(e=>e.roles).uniq().value().length}},function(){let{error:e}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};e&&(z(e.type),J(e.message||""))})},children:"Start Game"}),0===e.players.length&&(0,u.jsx)(p.Z,{size:"sm",className:"w-50 mt-3 mx-auto",variant:"danger",onClick:()=>o.emit("delete_room",{room:e.room}),children:"Delete"})]})},e.room)}),!L&&(0,u.jsx)(g.Z,{md:4,className:"text-center",children:(0,u.jsxs)("div",{className:"text-center p-3 d-flex flex-column h-100 justify-content-between",children:[(0,u.jsx)(C.Z.Label,{children:"Room ID"}),(0,u.jsx)(C.Z.Control,{className:"w-25 mx-auto mb-3 text-center",type:"text",placeholder:"Room ID",value:M,onChange:e=>G(e.target.value)}),(0,u.jsx)(p.Z,{className:"w-50 mx-auto",size:"sm",variant:"primary",onClick:()=>{o.emit("create_room",{room:M}),o.emit("join_room",{room:M,username:c||"Client"}),G(randomRoomId())},disabled:!0!==l||L,children:"Create"})]})})]})]}),(0,u.jsx)(T.Provider,{value:{socket:o,serverUrl:s,isConnected:l,roleInfo:d,currentRoom:W,myRoles:[...w]},children:n}),(0,u.jsxs)(E.Z,{show:!!K,onHide:()=>J(""),children:[(0,u.jsx)(E.Z.Header,{closeButton:!0,children:(0,u.jsx)(E.Z.Title,{children:H||"Error"})}),(0,u.jsx)(E.Z.Body,{children:(0,u.jsx)("p",{children:K})})]})]})};var B=t(7172);(s=i||(i={})).OCEAN="Ocean",s.MOUNTAIN="Mountain",s.PLAINS="Plains",s.WOODS="Woods",s.MESA="Mesa";let M={Ocean:"\uD83C\uDF0A",Mountain:"⛰️",Plains:"\uD83C\uDF3E",Woods:"\uD83C\uDF32",Mesa:"\uD83C\uDFDC️"};(r=c||(c={})).EARTHQUAKE="Earthquake",r.FIRE="Fire",r.FLOOD="Flood",r.WINDSTORM="Windstorm",(o=m||(m={}))[o.UP=0]="UP",o[o.DOWN=1]="DOWN",o[o.FOREIGN_AID=2]="FOREIGN_AID",o[o.CLIMATE_GHOST=3]="CLIMATE_GHOST",o[o.END_TURN=4]="END_TURN",o[o.RENAME_REGION=5]="RENAME_REGION",(a=d||(d={})).RED="#C0392B",a.GREEN="#27AE60",a.YELLOW="#F1C40F",a.BLUE="#2980B9",a.MAGENTA="#8E44AD",a.CYAN="#17C4C4",a.WHITE="#ECF0F1",a.ORANGE="#E67E22",a.PURPLE="#9B59B6";let G={[i.MESA]:"#C0392B",[i.MOUNTAIN]:"#17C4C4",[i.OCEAN]:"#2980B9",[i.PLAINS]:"#F1C40F",[i.WOODS]:"#27AE60"};c.EARTHQUAKE,c.FIRE,c.FLOOD,c.WINDSTORM;let P={91:"#C0392B",92:"#27AE60",93:"#F1C40F",94:"#2980B9",95:"#8E44AD",96:"#17C4C4",97:"#ECF0F1",33:"#E67E22",105:"#9B59B6"},ansiToHtml=e=>(e=(e=e.replace(/\x1b\[(\d+)m/g,(e,n)=>{let t=P[n];return t?'<span style="color:'.concat(t,'">'):"0"===n?"</span>":e})).replace(/\n/g,"<br><br>"),"<div>".concat(e,"</div>")),U=["#C0392B","#27AE60","#8E44AD","#E67E22","#17C4C4"];var W=t(8540),L=t(5929),H=t(9591),z=t(6409),K=t(7769);(l=h||(h={})).ByOwner="By Owner",l.ByRegionType="By Region Type",l.ByHealth="By Health";var game=()=>{let{socket:e,currentRoom:n,roleInfo:t,myRoles:s}=(0,x.useContext)(T),[r,o]=(0,x.useState)(void 0),[a,l]=(0,x.useState)([]),c=(0,z.g)()||1e3,y=(0,x.useMemo)(()=>n&&t?t.map((e,t)=>{var s;return(null===(s=n.players.find(e=>e.roles.includes(t)))||void 0===s?void 0:s.name)||"Unknown"}):[],[n,t]),[C,w]=(0,x.useState)(!1);(0,x.useEffect)(()=>{e&&(e.on("game_started",e=>{e.state&&o(JSON.parse(e.state))}),e.on("operators_available",e=>{l(e.operators)}),e.on("operator_applied",e=>{e.state&&o(JSON.parse(e.state))}),e.on("transition",e=>{let{message:n}=e;A(n)}),e.on("game_ended",e=>{let{message:n}=e;A(n),w(!0)}))},[e]);let[f,O]=(0,x.useState)(-1),R=f<0||!r?void 0:r.world.regions[f],D=null==r?void 0:r.players[null==r?void 0:r.current_player],b=!!r&&s.includes(r.current_player),regionForGeo=e=>{let n=parseInt(e.rsmKey.replace("geo-",""));return r.world.regions[n]},nameForPlayer=e=>{var n;return"".concat(null==t?void 0:null===(n=t[e])||void 0===n?void 0:n.name," (").concat(y[e],")")},[S,A]=(0,x.useState)(""),[k,P]=(0,x.useState)("By Owner");return(0,u.jsxs)("div",{className:"h-auto user-select-none",children:[r&&(0,u.jsxs)("div",{className:"overflow-hidden position-relative d-flex",children:[(0,u.jsx)(B.ComposableMap,{height:1e3,width:2e3,style:{background:G[i.OCEAN],height:c,width:"100%"},onClick:()=>{O(-1)},children:(0,u.jsx)(B.ZoomableGroup,{center:[0,0],zoom:4,minZoom:3,children:(0,u.jsx)(B.Geographies,{geography:"/earth-health-game/map.geo.json",children:e=>{let{geographies:n}=e,t=I().chain(n).filter((e,n)=>n<r.world.region_count).orderBy([e=>regionForGeo(e).id===f,e=>regionForGeo(e).current_player===r.current_player,e=>!(regionForGeo(e).id in D.current_actions)]).value();return t.map(e=>{let n=regionForGeo(e),t="#666";if(n.health>0)switch(k){case"By Region Type":t=G[n.region_type._value_];break;case"By Owner":t=U[n.current_player];break;case"By Health":t=(0,L.Z)(d.RED,d.GREEN)(n.health/10)}let s=n.id===f,o=b&&n.current_player===r.current_player&&!(n.id in D.current_actions);return(0,u.jsx)(B.Geography,{geography:e,fill:t,style:{default:{stroke:s?"#FFF":o?"#0F0":"#666",strokeWidth:1,outline:"none"},hover:{stroke:s?"#FFF":o?"#0F0":"#666",strokeWidth:1,fill:(0,H.ZP)(t,"#FFF")(.2),outline:"none"}},onClick:e=>{e.stopPropagation(),O(s?-1:n.id)}},n.name)}).concat(t.map(e=>{let n=regionForGeo(e),t=(0,W.Z)(e);return(0,u.jsxs)(B.Marker,{coordinates:t,className:"pointer-events-none",children:[(0,u.jsx)("text",{textAnchor:"middle",y:-2,style:{fontFamily:"system-ui",fontWeight:"bold",fontSize:5,fill:"#000"},stroke:"#FFF",strokeWidth:.2,children:n.name}),(0,u.jsx)("text",{textAnchor:"middle",y:4,style:{fontFamily:"system-ui",fontWeight:"bold",fontSize:5,fill:"#000"},stroke:"#FFF",strokeWidth:.2,children:n.health>0?(0,u.jsxs)(u.Fragment,{children:[n.health,"❤️",M[n.region_type._value_]]}):(0,u.jsx)(u.Fragment,{children:"\uD83D\uDC80"})})]},e.rsmKey)}))}})})}),(0,u.jsxs)("div",{className:"position-absolute w-100 h-100 pointer-events-none",children:[(0,u.jsxs)(j.Z,{className:"position-absolute shadow-lg w-25 ms-4 mt-4 p-3",children:[(0,u.jsx)("h3",{className:"text-center",children:"Player Info"}),(0,u.jsx)(F.Z,{className:"row-cols-1 g-3",children:r.players.map((e,n)=>(0,u.jsx)(g.Z,{children:(0,u.jsxs)(F.Z,{className:"row-cols-1 p-2 g-2 rounded-2",style:{border:".5rem ".concat(U[n]," solid")},children:[(0,u.jsxs)(g.Z,{children:[nameForPlayer(n),": $",e.money,"M"]}),Object.values(r.world.regions).filter(n=>n.current_player===e.player_id).map((e,n)=>(0,u.jsxs)(g.Z,{className:"ms-4",children:[e.name," (",e.region_type._value_,","," ",e.health,"❤️)"]},n))]})},n))}),(0,u.jsx)("h3",{className:"text-center mt-3",children:"State Info"}),(0,u.jsxs)(F.Z,{className:"row-cols-1 g-2",children:[(0,u.jsxs)(g.Z,{children:["Time: ",r.time]}),(0,u.jsxs)(g.Z,{children:["Climate Badness ",r.global_badness]})]})]}),R&&(0,u.jsxs)(j.Z,{className:"position-absolute shadow-lg w-25 mt-4 me-4 p-3 end-0 pointer-events-auto",children:[(0,u.jsxs)("h2",{className:"text-center",children:[R.name,s.includes(R.current_player)&&(0,u.jsx)(p.Z,{size:"sm",variant:"outline-primary",className:"border-0",onClick:()=>{let n=prompt("Choose a new name for this region",R.name);n&&n!==R.name&&e.emit("operator_chosen",{op_no:m.RENAME_REGION,params:[R.id,n]})},children:(0,u.jsx)(K.Z,{})})]}),(0,u.jsxs)(F.Z,{className:"fs-5 g-2 row-cols-2",children:[(0,u.jsx)(g.Z,{children:R.health>0&&"Owned by ".concat(nameForPlayer(R.current_player))}),(0,u.jsxs)(g.Z,{children:["Region Type: ",R.region_type._value_,M[R.region_type._value_]]}),(0,u.jsxs)(g.Z,{children:["Health:"," ",R.health>0?"".concat(R.health,"❤️"):"\uD83D\uDC80"]})]}),(0,u.jsx)("h3",{className:"text-center",children:"Actions"}),(0,u.jsxs)(F.Z,{className:"row-cols-1 g-2 justify-content-center",children:[!b&&(0,u.jsx)(g.Z,{children:"Not your turn."}),R.id in D.current_actions?(0,u.jsx)(g.Z,{children:"Already taken action this turn."}):(0,u.jsx)(u.Fragment,{children:a.filter(e=>{switch(e.op_no){case m.UP:case m.DOWN:return R.current_player==r.current_player;case m.FOREIGN_AID:return R.current_player!==r.current_player;default:return!1}}).map(n=>(0,u.jsx)(g.Z,{xs:"auto",children:(0,u.jsx)(p.Z,{onClick:()=>e.emit("operator_chosen",{op_no:n.op_no,params:[f]}),children:n.name})}))})]})]}),(0,u.jsx)(j.Z,{className:"position-absolute bottom-0 end-0 m-4 shadow-lg w-auto p-3",children:(0,u.jsx)("h3",{className:"text-center pointer-events-auto",children:a.length>0?(0,u.jsxs)(u.Fragment,{children:[(0,u.jsx)("div",{children:"It is your turn"}),(0,u.jsx)(p.Z,{className:"mt-3 w-100",variant:r.world.regions.some(e=>e.current_player===r.current_player&&!(e.id in D.current_actions))?"primary":"success",onClick:()=>e.emit("operator_chosen",{op_no:m.END_TURN,params:null}),children:"End Turn"})]}):"".concat(nameForPlayer(r.current_player)," is acting")})}),(0,u.jsx)(j.Z,{className:"position-absolute bottom-0 start-0 m-4 shadow-lg w-auto p-3",children:(0,u.jsx)(F.Z,{className:"row-cols-1 g-3 pointer-events-auto",children:(0,u.jsxs)(g.Z,{className:"d-flex flex-row align-items-center",children:[(0,u.jsx)("span",{className:"me-3",children:"Region Color Mode"}),(0,u.jsxs)(_.Z,{children:[(0,u.jsx)(v.Z,{size:"sm",children:k}),(0,u.jsx)(Z.Z,{children:Object.values(h).map(e=>(0,u.jsx)(N.Z,{active:e===k,onClick:()=>P(e),children:e},e))})]})]})})})]})]}),(0,u.jsxs)(E.Z,{size:"lg",show:!!S,onHide:()=>{A(""),C&&window.location.reload()},backdrop:"static",className:"user-select-none",children:[(0,u.jsx)(E.Z.Header,{closeButton:!0,children:(0,u.jsx)(E.Z.Title,{children:C?"Game Over!":"Transition"})}),(0,u.jsx)(E.Z.Body,{children:(0,u.jsx)("p",{dangerouslySetInnerHTML:{__html:ansiToHtml(S)}})})]})]})},pages=()=>(0,u.jsx)(u.Fragment,{children:(0,u.jsx)(SocketIOCommon,{title:"Collaborative Climate Contest",children:(0,u.jsx)(game,{})})})}},function(e){e.O(0,[662,743,774,888,179],function(){return e(e.s=8312)}),_N_E=e.O()}]);