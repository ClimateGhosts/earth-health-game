(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[405],{8312:function(e,t,a){(window.__NEXT_P=window.__NEXT_P||[]).push(["/",function(){return a(7149)}])},7149:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return pages}});var r,n,o,l,i,c,m=a(5893),d=a(7294),h=a(5005),u=a(8837),x=a(1555),p=a(682),j=a(4247),g=a(4490),y=a(2960),_=a(2749),v=a(4486),N=a(2914),Z=a(7017),b=a(4051),f=a(2599),E=a(8817),w=a(1978),F=a(1143),C=a(1515),k=a(5386),O=a(6486),A=a.n(O),R=a(9578),T=a(9019),S=a(5378);let I=(0,d.createContext)({socket:void 0,serverUrl:"https://earth-health-game.appmana.com",isConnected:!1,myRoles:[]}),createSocket=e=>{let t=(0,f.io)(e);return t.url=e,t},SocketIOCommon=e=>{let{children:t,title:a}=e,[r,n]=(0,E.Z)("serverUrl","https://earth-health-game.appmana.com"),[o,l]=(0,d.useState)(()=>createSocket(r)),[i,c]=(0,d.useState)(null),[f,O]=(0,E.Z)("username","Client"),[R,T]=(0,d.useState)([]),[S,D]=(0,w.Z)(new Set([])),[G,L]=(0,d.useState)(!1),[M,B]=(0,d.useState)(""),[H,P]=(0,d.useState)([]),[W,z]=(0,F.Z)({}),randomRoomId=()=>Math.round(new Date().getMilliseconds()).toString(),[U,Y]=(0,d.useState)(randomRoomId()),[X,q]=(0,C.Z)([]),J=X.find(e=>e.players.some(e=>e.sid===M)),K=!!J;(0,d.useEffect)(()=>(setTimeout(()=>{o.connected||c(!1)},2e3),q.clear(),o.on("connect",()=>{c(!0),console.log("Client Connected"),o.emit("list_roles",{},e=>{let{roles:t}=e;T(t)}),o.emit("list_rooms",{},e=>{let{rooms:t}=e;q.set(t)}),o.emit("info",{},e=>{console.log(e)}),o.emit("list_options",{},e=>{let{options:t}=e;P(t),z.setAll(Object.fromEntries(t.map(e=>[e.name,e.default])))})}),o.on("disconnect",()=>{c(!1),q.clear(),console.log("Client Disconnected")}),o.on("your_sid",e=>{let{sid:t}=e;B(t)}),o.onAny((e,t)=>{console.log(e,t)}),o.on("game_started",()=>{L(!0)}),o.on("room_changed",e=>{q.update(t=>t.room==e.room,e)}),o.on("room_created",e=>{let{room:t,owner_sid:a}=e;q.push({room:t,owner:a,in_game:!1,players:[]})}),o.on("room_deleted",e=>{let{room:t}=e;q.filter((e,a,r)=>e.room!=t)}),()=>{o.disconnect(),o.close()}),[o]),(0,k.Z)(()=>{r!==o.url&&(o.connected&&o.disconnect(),o.close(),c(null),l(createSocket(r)))},1e3,[r]),(0,k.Z)(()=>{(null==o?void 0:o.connected)&&o.emit("set_roles",{roles:[...S]})},500,[S]),(0,k.Z)(()=>{f&&(null==o?void 0:o.connected)&&o.emit("set_name",{name:f})},500,[f]);let[V,$]=(0,d.useState)(""),[Q,ee]=(0,d.useState)("");return(0,m.jsxs)(m.Fragment,{children:[G||(0,m.jsxs)(p.Z,{children:[a&&(0,m.jsx)("h1",{className:"text-center m-2",children:a}),(0,m.jsxs)(b.Z,{className:"align-items-center m-2 g-3 justify-content-center",children:[(0,m.jsxs)(x.Z,{md:4,children:[(0,m.jsx)(N.Z.Label,{children:"Server URL"}),(0,m.jsxs)("div",{className:"position-relative",children:[(0,m.jsx)(N.Z.Control,{type:"text",placeholder:"Enter server URL",value:r,onChange:e=>n(e.target.value)}),(0,m.jsx)("div",{className:"end-0 position-absolute absolute-centered-y me-2",children:(0,m.jsx)(Indicator,{status:(null==o?void 0:o.url)===r?i:null})})]})]}),(0,m.jsxs)(x.Z,{md:2,children:[(0,m.jsx)(N.Z.Label,{children:"Username"}),(0,m.jsx)(N.Z.Control,{type:"text",placeholder:"Enter username",value:f,onChange:e=>O(e.target.value),maxLength:23})]})]}),(0,m.jsx)("h3",{className:"text-center my-3",children:"Rooms"}),(0,m.jsxs)(b.Z,{className:"g-3 justify-content-center",children:[X.map(e=>{let t=e.players.some(e=>e.sid===M),a=e.owner===M;return(0,m.jsx)(x.Z,{md:4,children:(0,m.jsxs)(u.Z,{className:"text-center p-3 d-flex flex-column h-100 shadow-sm justify-content-between",children:[(0,m.jsxs)("h5",{children:["#",e.room]}),e.players.map(e=>(0,m.jsxs)("div",{className:"d-flex justify-content-center align-items-center my-2",children:[e.name,e.sid===M?(0,m.jsxs)(j.Z,{autoClose:"outside",className:"ms-2",children:[(0,m.jsx)(v.Z,{size:"sm",className:"text-wrap",children:[...S].sort().map(e=>R[e].name).join(", ")||"No Roles"}),(0,m.jsx)(_.Z,{className:"py-0",children:R.map((e,t)=>(0,m.jsxs)(g.Z,{active:D.has(t),className:"my-2 rounded-2",onClick:()=>D.has(t)?D.remove(t):D.add(t),children:[e.name," (min ",e.min,", max ",e.max,")"]},t))})]}):(0,m.jsxs)(m.Fragment,{children:[" ","(",e.roles.sort().map(e=>R[e].name).join(", ")||"No Roles",")"]})]},e.name)),!t&&(0,m.jsx)(h.Z,{size:"sm",className:"w-50 mt-3 mx-auto",variant:"primary",onClick:()=>{o.emit("join_room",{room:e.room,username:f||null}),o.emit("set_roles",{roles:[...S]})},disabled:e.in_game,children:e.in_game?"In Game":"Join"}),t&&(0,m.jsx)(h.Z,{size:"sm",className:"w-50 mt-3 mx-auto",variant:"danger",onClick:()=>o.emit("leave_room",{}),children:"Leave"}),a&&t&&(0,m.jsxs)(m.Fragment,{children:[(0,m.jsx)(h.Z,{size:"sm",className:"w-50 mt-3 mx-auto",variant:"success",onClick:()=>{console.log(W),o.emit("set_roles",{roles:[...S]}),o.emit("start_game",{args:{...W,players:A().chain(e.players).flatMap(e=>e.roles).uniq().value().length}},function(){let{error:e}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};e&&($(A().startCase(e.type)),ee(e.message||""))})},children:"Start Game"}),(null==H?void 0:H.length)&&(0,m.jsxs)(j.Z,{className:"mt-3",autoClose:"outside",children:[(0,m.jsx)(v.Z,{size:"sm",variant:"outline-primary",className:"border-0 text-body",children:"Options"}),(0,m.jsx)(_.Z,{children:H.filter(e=>!!e.description).map((e,t)=>(0,m.jsx)(y.Z,{children:(0,m.jsxs)(b.Z,{className:"row-cols-2",children:[(0,m.jsx)(x.Z,{xs:"auto",className:"me-auto d-flex align-items-center",children:e.name}),(0,m.jsx)(x.Z,{xs:"auto",children:"bool"===e.type?(0,m.jsx)(h.Z,{size:"sm",variant:!0==z.get(e.name)?"success":"danger",onClick:()=>z.set(e.name,!z.get(e.name)),children:!0==z.get(e.name)?"True":"False"}):(0,m.jsx)(N.Z.Control,{size:"sm",className:"w-50 ms-auto",value:String(z.get(e.name)),type:"str"===e.type?"text":"number",onChange:t=>z.set(e.name,getOptionValue(e,t.target.value))})}),(0,m.jsx)(x.Z,{xs:"auto",className:"text-black-50",children:e.description})]})},t))})]})]}),0===e.players.length&&(0,m.jsx)(h.Z,{size:"sm",className:"w-50 mt-3 mx-auto",variant:"danger",onClick:()=>o.emit("delete_room",{room:e.room}),children:"Delete"})]})},e.room)}),!K&&(0,m.jsx)(x.Z,{md:4,className:"text-center",children:(0,m.jsxs)("div",{className:"text-center p-3 d-flex flex-column h-100 justify-content-between",children:[(0,m.jsx)(N.Z.Label,{children:"Room ID"}),(0,m.jsx)(N.Z.Control,{className:"w-25 mx-auto mb-3 text-center",type:"text",placeholder:"Room ID",value:U,onChange:e=>Y(e.target.value),maxLength:4}),(0,m.jsx)(h.Z,{className:"w-50 mx-auto",size:"sm",variant:"primary",onClick:()=>{o.emit("create_room",{room:U}),o.emit("join_room",{room:U,username:f||"Client"}),Y(randomRoomId())},disabled:!0!==i||K,children:"Create"})]})})]})]}),(0,m.jsx)(I.Provider,{value:{socket:o,serverUrl:r,isConnected:i,roleInfo:R,currentRoom:J,myRoles:[...S],leaveGame:()=>{L(!1),D.reset(),o.emit("leave_room",{})}},children:t}),(0,m.jsxs)(Z.Z,{show:!!Q,onHide:()=>ee(""),children:[(0,m.jsx)(Z.Z.Header,{closeButton:!0,children:(0,m.jsx)(Z.Z.Title,{children:V||"Error"})}),(0,m.jsx)(Z.Z.Body,{children:(0,m.jsx)("p",{children:Q})})]})]})},Indicator=e=>{let{status:t}=e;return!0===t?(0,m.jsx)(R.Z,{color:"green"}):!1===t?(0,m.jsx)(T.Z,{color:"red"}):(0,m.jsx)(S.Z,{color:"orange"})},getOptionValue=(e,t)=>{switch(e.type){case"str":return String(t);case"bool":return!!t;case"int":return"string"==typeof t?parseInt(t):Number(t);case"float":return"string"==typeof t?parseFloat(t):Number(t)}};var D=a(7176),G=a(9517),L=a(3489);(r=l||(l={}))[r.EXPLOIT=0]="EXPLOIT",r[r.HEAL=1]="HEAL",r[r.FOREIGN_AID=2]="FOREIGN_AID",r[r.CLIMATE_GHOST=3]="CLIMATE_GHOST",r[r.END_TURN=4]="END_TURN",r[r.RENAME_REGION=5]="RENAME_REGION";var M=a(7769),B=a(1711),H=a(3967),P=a.n(H),W=a(619),z=a(9591),disaster_entry=e=>{let{disaster:t,state:a,nameForPlayer:r}=e,n=null==a?void 0:a.world.regions[t.region_id];return(0,m.jsxs)(m.Fragment,{children:[ea.disaster[t.disaster].emoji,t.disaster,t.damage&&(0,m.jsxs)(m.Fragment,{children:[" ","dealt"," ",(0,m.jsxs)("span",{style:{color:colorForDamage(t.damage)},children:[t.damage," damage"]})]}),n&&(0,m.jsxs)(m.Fragment,{children:[" ","in ",ea.biome[n.biome].emoji,n.name,n.health<=0&&" (DESTROYED\uD83D\uDC80)",r&&(0,m.jsxs)(m.Fragment,{children:[" for ",r(t.current_owner)]})]})]})};let colorForDamage=e=>(0,z.ZP)("black",e>4?"red":"green")(Math.min((1+Math.abs(4-e))/3,1)),s=e=>"".concat(e>=0?"+":"").concat(e);var selected_region_panel=e=>{var t,a;let{className:r}=e,{socket:n,myRoles:o}=(0,d.useContext)(I),{state:i,currentRegion:c,selectedRegion:p,currentPlayer:j,myTurn:g,operators:y,nameForPlayer:_,gameOver:v}=(0,d.useContext)(et),[N]=(0,W.Z)("/earth-health-game/audio/EarthHealthExploit.mp3"),[Z]=(0,W.Z)("/earth-health-game/audio/EarthHealthHeal.mp3"),f=ea.biome[null!==(t=null==c?void 0:c.biome)&&void 0!==t?t:""],E=Object.values(null!==(a=null==c?void 0:c.devastation_history)&&void 0!==a?a:{}).flat();return c&&(0,m.jsx)(u.Z,{className:P()("shadow-lg w-25 p-3 overflow-y-auto  pointer-events-auto",r),style:{maxHeight:"70vh"},children:(0,m.jsxs)(b.Z,{className:"row-cols-1 g-3",children:[(0,m.jsxs)(x.Z,{className:"text-center",children:[(0,m.jsxs)("h2",{className:"mb-3",children:[c.name,o.includes(c.current_player)&&(0,m.jsx)(h.Z,{size:"sm",variant:"outline-primary",className:"border-0",onClick:()=>{let e=prompt("Choose a new name for this region",c.name);e&&e!==c.name&&n.emit("operator_chosen",{op_no:l.RENAME_REGION,params:[c.id,e]})},children:(0,m.jsx)(M.Z,{})})]}),(0,m.jsxs)(b.Z,{className:"fs-5 g-2 row-cols-2",children:[c.health>0&&(0,m.jsxs)(x.Z,{children:["Owned by: ",_(c.current_player)]}),(0,m.jsxs)(x.Z,{children:["Biome: ",c.biome,ea.biome[c.biome].emoji]}),(0,m.jsxs)(x.Z,{children:["Health: ",c.health>0?"".concat(c.health,"❤️"):"\uD83D\uDC80"]})]})]}),(0,m.jsxs)(x.Z,{className:"text-center",children:[(0,m.jsx)("h3",{className:"mb-3",children:"Disaster History"}),(0,m.jsx)(b.Z,{className:"row-cols-1 g-3 justify-content-center",children:E.length>0?Object.entries(c.devastation_history).map(e=>{let[t,a]=e;return(0,m.jsx)(d.Fragment,{children:a.map((e,a)=>(0,m.jsxs)(x.Z,{children:[displayTime(parseInt(t)),": ",(0,m.jsx)(disaster_entry,{disaster:e})]},a))},t)}):(0,m.jsx)(x.Z,{children:"No disasters have hit this region yet."})})]}),c.current_player>=0&&(0,m.jsxs)(x.Z,{className:"text-center",children:[(0,m.jsx)("h3",{className:"mb-3",children:"Disaster Affinity"}),(0,m.jsx)(b.Z,{className:"row-cols-2 g-2",children:ea.disasters.map(e=>{var t,a,r;let n=e.damage,o=["".concat(n," base damage")],l=null!==(t=f.disaster_matrix[e.name])&&void 0!==t?t:0;for(let t of(n+=l,o.push("".concat(s(l)," from ").concat(f.emoji).concat(f.name)),E)){let l=ea.disaster[t.disaster],i=null!==(r=null===(a=l.disaster_matrix)||void 0===a?void 0:a[e.name])&&void 0!==r?r:0;n+=i,0!==i&&o.push("".concat(s(i)," from prior ").concat(l.emoji).concat(l.name))}return o.push("= ".concat(n," total damage")),(0,m.jsxs)(x.Z,{className:"d-flex flex-row justify-content-center align-items-center",children:[e.emoji,e.name,":",(0,m.jsxs)("span",{className:"mx-1",style:{color:colorForDamage(n)},children:[n," damage"]}),(0,m.jsx)(G.Z,{overlay:(0,m.jsx)(L.Z,{children:o.map((e,t)=>(0,m.jsx)("div",{children:e},t))}),children:(0,m.jsx)(B.Z,{className:"text-muted"})})]},e.name)})})]}),!v&&c.current_player>=0&&(0,m.jsxs)(x.Z,{children:[(0,m.jsx)("h3",{className:"text-center mb-3",children:"Actions"}),(0,m.jsxs)(b.Z,{className:"row-cols-1 g-3 justify-content-center",children:[!g&&(0,m.jsx)(x.Z,{children:"Not your turn."}),c.id in j.current_actions?(0,m.jsx)(x.Z,{children:"Already taken action this turn."}):(0,m.jsx)(m.Fragment,{children:y.filter(e=>{switch(e.op_no){case l.EXPLOIT:case l.HEAL:return c.current_player==i.current_player;case l.FOREIGN_AID:return c.health>0&&c.current_player!==i.current_player;default:return!1}}).map(e=>(0,m.jsx)(x.Z,{xs:"auto",children:(0,m.jsx)(h.Z,{onClick:()=>{switch(n.emit("operator_chosen",{op_no:e.op_no,params:[p]}),e.op_no){case l.HEAL:Z();break;case l.EXPLOIT:N()}},children:e.name})}))})]})]})]})})},end_turn_panel=e=>{let{className:t}=e,{socket:a,leaveGame:r}=(0,d.useContext)(I),{state:n,currentPlayer:o,operators:i,nameForPlayer:c,gameOver:x}=(0,d.useContext)(et),p=i.find(e=>e.op_no===l.CLIMATE_GHOST);return(0,m.jsx)(u.Z,{className:P()("shadow-lg w-auto p-3",t),children:(0,m.jsx)("h3",{className:"text-center pointer-events-auto",children:x?(0,m.jsxs)(m.Fragment,{children:[(0,m.jsx)("div",{children:"The Game Is Over!"}),(0,m.jsx)(h.Z,{className:"mt-3 w-100",onClick:()=>null==r?void 0:r(),children:"Return Home"})]}):i.length>0?(0,m.jsxs)(m.Fragment,{children:[(0,m.jsx)("div",{children:"It is your turn."}),p&&(0,m.jsx)(h.Z,{className:"mt-3 w-100",variant:"warning",onClick:()=>a.emit("operator_chosen",{op_no:l.CLIMATE_GHOST,params:null}),children:p.name}),(0,m.jsx)(h.Z,{className:"mt-3 w-100",variant:n.world.regions.some(e=>e.current_player===n.current_player&&!(e.id in o.current_actions))?"primary":"success",onClick:()=>a.emit("operator_chosen",{op_no:l.END_TURN,params:null}),children:"End Turn"})]}):"".concat(c(n.current_player)," is acting.")})})};(n=i||(i={})).RED="#C0392B",n.GREEN="#27AE60",n.YELLOW="#F1C40F",n.BLUE="#2980B9",n.MAGENTA="#8E44AD",n.CYAN="#17C4C4",n.WHITE="#ECF0F1",n.ORANGE="#E67E22",n.PURPLE="#9B59B6";let biomeColor=e=>i[ea.biome[e].color],playerColor=e=>i[ea.player_colors[e]];var U=a(5472),Y=a.n(U);let ClimateBadness=e=>{let{state:t}=e,a=t.base_disasters+t.global_badness*t.disasters_per_badness,r="Moderate";return a>=5&&(r="Bad"),a>=7&&(r="Terrible"),a>=9&&(r="Apocalyptic"),(0,m.jsxs)(m.Fragment,{children:["Climate Severity: ",r,(0,m.jsx)(G.Z,{overlay:(0,m.jsxs)(L.Z,{children:["Disasters Per Round: ~",a.toFixed(1)]}),children:(0,m.jsx)(B.Z,{className:"text-muted mb-1 ms-1"})})]})};var state_info_panel=e=>{let{className:t}=e,{myRoles:a}=(0,d.useContext)(I),{state:r,nameForPlayer:n}=(0,d.useContext)(et);return(0,m.jsxs)(u.Z,{className:P()("shadow-lg w-25 p-3 overflow-y-auto pointer-events-auto",t),style:{maxHeight:"80vh"},children:[(0,m.jsx)("h3",{className:"text-center",children:"State Info"}),(0,m.jsxs)(b.Z,{className:"row-cols-1 g-2",children:[(0,m.jsxs)(x.Z,{children:["Time: ",displayTime(r.time)," (playing until ",displayTime(r.final_turn),")"]}),(0,m.jsx)(x.Z,{children:(0,m.jsx)(ClimateBadness,{state:r})})]}),r.players.some(e=>a.includes(e.player_id)&&e.regions_owned<=0)&&(0,m.jsxs)(m.Fragment,{children:[(0,m.jsx)("h3",{className:"text-center my-3",children:"Next Possible Disasters"}),(0,m.jsx)(b.Z,{className:"row-cols-1 g-3",children:r.disaster_buffer.map((e,t)=>(0,m.jsx)(x.Z,{children:(0,m.jsx)(disaster_entry,{disaster:e,state:r,nameForPlayer:n})},t))})]}),(0,m.jsx)("h3",{className:"text-center my-3",children:"Player Info"}),(0,m.jsx)(b.Z,{className:"row-cols-1 g-3",children:Y()(r.players,e=>!a.includes(e.player_id)).map(e=>(0,m.jsx)(x.Z,{children:(0,m.jsx)(b.Z,{className:"row-cols-1 p-2 g-2 rounded-2",style:{border:".5rem ".concat(playerColor(e.player_id)," solid")},children:e.regions_owned>0?(0,m.jsxs)(m.Fragment,{children:[(0,m.jsxs)(x.Z,{children:[n(e.player_id),": ",displayMoney(e.money)]}),Object.values(r.world.regions).filter(t=>t.current_player===e.player_id).map((e,t)=>(0,m.jsxs)(x.Z,{className:"ms-4",children:[e.name," (",e.biome,ea.biome[e.biome].emoji,", ",e.health,"❤️)"]},t))]}):(0,m.jsxs)(m.Fragment,{children:[n(e.player_id)," \uD83D\uDC7B"]})})},e.player_id))})]})};(o=c||(c={})).ByOwner="By Owner",o.ByBiome="By Biome",o.ByHealth="By Health";var visual_options_panel=e=>{let{className:t}=e,{options:{colorMode:a,setColorMode:r}}=(0,d.useContext)(et);return(0,m.jsx)(u.Z,{className:P()("position-absolute shadow-lg w-auto p-3",t),children:(0,m.jsx)(b.Z,{className:"row-cols-1 g-3 pointer-events-auto",children:(0,m.jsxs)(x.Z,{className:"d-flex flex-row align-items-center",children:[(0,m.jsx)("span",{className:"me-3",children:"Region Color Mode"}),(0,m.jsxs)(j.Z,{children:[(0,m.jsx)(v.Z,{size:"sm",children:a}),(0,m.jsx)(_.Z,{children:Object.values(c).map(e=>(0,m.jsx)(g.Z,{active:e===a,onClick:()=>r(e),children:e},e))})]})]})})})},transitions_model=e=>{let{body:t,title:a,onHide:r}=e;return(0,m.jsxs)(Z.Z,{size:"lg",show:!!t,onHide:r,backdrop:"static",className:"user-select-none",children:[(0,m.jsx)(Z.Z.Header,{closeButton:!0,children:(0,m.jsx)(Z.Z.Title,{children:a})}),(0,m.jsx)(Z.Z.Body,{children:t})]})},X=a(7172),q=a(6409),J=a(5929),region_geography=e=>{let{geo:t}=e,{state:a,selectedRegion:r,setSelectedRegion:n,myTurn:o,currentPlayer:l,options:{colorMode:h}}=(0,d.useContext)(et),u=regionForGeo(t,a),x="#666";if(u.health>0)switch(h){case c.ByBiome:x=biomeColor(u.biome);break;case c.ByOwner:x=playerColor(u.current_player);break;case c.ByHealth:x=(0,J.Z)(i.RED,i.GREEN)(u.health/10)}let p=u.id===r,j=o&&u.current_player===a.current_player&&!(u.id in l.current_actions)&&u.health>0;return(0,m.jsx)(X.Geography,{geography:t,fill:x,style:{default:{stroke:p?"#FFF":j?"#0F0":"#666",strokeWidth:1,outline:"none"},hover:{stroke:p?"#FFF":j?"#0F0":"#666",strokeWidth:1,fill:(0,z.ZP)(x,"#FFF")(.2),outline:"none"}},onClick:e=>{e.stopPropagation(),n(p?-1:u.id)}})},K=a(8540),region_marker=e=>{let{geo:t}=e,{state:a}=(0,d.useContext)(et),r=regionForGeo(t,a),n=(0,K.Z)(t);return(0,m.jsxs)(X.Marker,{coordinates:n,className:"pointer-events-none",children:[(0,m.jsx)("text",{textAnchor:"middle",y:-8,style:{fontFamily:"system-ui",fontWeight:"bold",fontSize:5,fill:"#000"},stroke:"#FFF",strokeWidth:.2,children:Object.values(r.devastation_history).flat().map(e=>ea.disaster[e.disaster].emoji)}),(0,m.jsx)("text",{textAnchor:"middle",y:-2,style:{fontFamily:"system-ui",fontWeight:"bold",fontSize:5,fill:"#000"},stroke:"#FFF",strokeWidth:.2,children:r.name}),(0,m.jsx)("text",{textAnchor:"middle",y:4,style:{fontFamily:"system-ui",fontWeight:"bold",fontSize:5,fill:"#000"},stroke:"#FFF",strokeWidth:.2,children:r.health>0?(0,m.jsxs)(m.Fragment,{children:[r.health,"❤️",ea.biome[r.biome].emoji]}):(0,m.jsx)(m.Fragment,{children:"\uD83D\uDC80"})})]})};let regionForGeo=(e,t)=>{let a=parseInt(e.rsmKey.replace("geo-",""));return t.world.regions[a]};var game_map=()=>{let e=(0,q.g)()||1e3,{state:t,currentPlayer:a,selectedRegion:r,setSelectedRegion:n}=(0,d.useContext)(et),reorderGeos=e=>A().chain(e).filter((e,a)=>a<t.world.region_count).orderBy([e=>regionForGeo(e,t).id===r,e=>regionForGeo(e,t).current_player===t.current_player,e=>!(regionForGeo(e,t).id in a.current_actions)]).value();return(0,m.jsx)(X.ComposableMap,{height:1e3,width:2e3,style:{background:i.BLUE,height:e,width:"100%"},onClick:()=>n(-1),children:(0,m.jsx)(X.ZoomableGroup,{zoom:4,minZoom:3,translateExtent:[[600,300],[1300,700]],children:(0,m.jsx)(X.Geographies,{geography:"/earth-health-game/map.geo.json",children:e=>{let{geographies:t}=e,a=reorderGeos(t);return a.map(e=>(0,m.jsx)(region_geography,{geo:e},e.rsmKey+"Geography")).concat(a.map(e=>(0,m.jsx)(region_marker,{geo:e},e.rsmKey+"Marker")))}})})})};let logMessageForOperator=(e,t,a)=>{let r="".concat(t," has ");switch(e.op_no){case l.EXPLOIT:case l.HEAL:case l.FOREIGN_AID:case l.RENAME_REGION:let n=a.world.regions[e.params[0]];switch(e.op_no){case l.EXPLOIT:r+="exploited ".concat(n.name,".");break;case l.HEAL:r+="healed ".concat(n.name,".");break;case l.FOREIGN_AID:r+="sent foreign aid to ".concat(n.name,".");break;case l.RENAME_REGION:r+="renamed ".concat(n.name," to ").concat(e.params[1],".")}break;case l.CLIMATE_GHOST:r+="has tipped the scales from beyond the grave.";break;case l.END_TURN:r+="ended their turn."}return r},logsForTransitions=(e,t)=>{let a=[];if(!e||e.time===t.time)return a;for(let e of t.devastations)a.push({time:t.time,message:"".concat(e.disaster," in ").concat(e.region," (").concat(e.damage," damage)")});for(let n of t.world.regions){var r;n.health<=0&&(null!==(r=null==e?void 0:e.world.regions[n.id].health)&&void 0!==r?r:0)>0&&a.push({time:t.time,message:"".concat(n.name," was destroyed!")})}return a};var game_log_panel=e=>{let{className:t,gameLogs:a}=e,[r,n]=(0,d.useState)(!1);return(0,m.jsxs)("div",{className:P()("w-50 h-25",t),children:[r&&(0,m.jsx)(u.Z,{className:"shadow-lg p-3 mb-5 h-100 overflow-y-scroll w-100 bottom-0 position-absolute d-flex flex-column-reverse pointer-events-auto",children:(0,m.jsx)("table",{children:Y()(a,e=>e.time).map((e,t)=>{let{time:a,message:r}=e;return(0,m.jsxs)("tr",{children:[(0,m.jsx)("td",{children:displayTime(a)}),(0,m.jsx)("td",{children:r})]},t)})})}),(0,m.jsx)(h.Z,{variant:"outline-dark",className:"border-0 fs-4 pointer-events-auto bottom-0 position-absolute absolute-centered-x",onClick:()=>n(!r),children:"Logs"})]})},V=JSON.parse('{"biomes":[{"name":"Ocean","color":"BLUE","playable":false,"emoji":"\uD83C\uDF0A","disaster_matrix":{"Earthquake":0,"Fire":0,"Flood":0,"Windstorm":0}},{"name":"Mountain","color":"CYAN","playable":true,"emoji":"⛰️","disaster_matrix":{"Earthquake":1,"Fire":-1,"Flood":-2,"Windstorm":2}},{"name":"Plains","color":"YELLOW","playable":true,"emoji":"\uD83C\uDF3E","disaster_matrix":{"Earthquake":-2,"Fire":1,"Flood":2,"Windstorm":-1}},{"name":"Woods","color":"GREEN","playable":true,"emoji":"\uD83C\uDF32","disaster_matrix":{"Earthquake":-1,"Fire":2,"Flood":1,"Windstorm":-2}},{"name":"Mesa","color":"RED","playable":true,"emoji":"\uD83C\uDFDC️","disaster_matrix":{"Earthquake":2,"Fire":-2,"Flood":-1,"Windstorm":1}}],"disasters":[{"name":"Earthquake","color":"GREEN","damage":4,"emoji":"\uD83E\uDEA8","disaster_matrix":{"Flood":1}},{"name":"Fire","color":"RED","damage":4,"emoji":"\uD83D\uDD25","disaster_matrix":{"Flood":-1,"Windstorm":1}},{"name":"Flood","color":"BLUE","damage":4,"emoji":"\uD83C\uDF0A","disaster_matrix":{"Fire":-1}},{"name":"Windstorm","color":"YELLOW","damage":4,"emoji":"\uD83C\uDF2A️","disaster_matrix":{"Earthquake":1}}],"player_colors":["RED","GREEN","MAGENTA","ORANGE","CYAN"],"adjacency":{"0":[6,7,12,14],"1":[3,5,18],"2":[19],"3":[1,5,8,13,16],"4":[8,15,16],"5":[1,3,13,17],"6":[0,7,12,15],"7":[0,6,10,13,14,15],"8":[3,4,10,13,15,16],"9":[19],"10":[7,8,13,15],"11":[16],"12":[0,6],"13":[3,5,7,8,10,14,17],"14":[0,7,13],"15":[4,6,7,8,10],"16":[3,4,8,11],"17":[5,13],"18":[1,19],"19":[2,9,18]},"names":["Nova Arcadia","Elysium","Astoria","Aetheria","Valoria","Xion","Seraphina","Atlantica","Zirvana","Avalon","Galadria","Mythos","Ytopia","Elysian Fields","Aurora","Celestia","Elympia","Excalibur","Aden","Arcadia"]}'),$=a(4350),Q=a.n($),menu_panel=e=>{let{className:t}=e,{leaveGame:a}=(0,d.useContext)(I);return(0,m.jsx)("div",{className:P()(t),children:(0,m.jsxs)(j.Z,{drop:"down-centered",className:"pointer-events-auto",children:[(0,m.jsx)(v.Z,{variant:"outline-dark",className:"border-0 fs-4 d-flex align-items-center",children:"Menu"}),(0,m.jsx)(_.Z,{children:(0,m.jsx)(g.Z,{onClick:()=>{confirm("Are you sure you want to leave? This will end the game for other players.")&&(null==a||a())},children:"Leave Game"})})]})})},ee=a(1966),es=a.n(ee),transition=e=>{let{prevState:t,newState:a,gameContext:r,socketContext:n}=e,{nameForPlayer:o}=r,{myRoles:l}=n,i=a.devastations.filter(e=>l.includes(t.world.regions[e.region_id].current_player)),c=es()(a.devastations,i);return(0,m.jsxs)(m.Fragment,{children:[(0,m.jsxs)("h4",{className:"mb-3",children:["Time has progressed from ",displayTime(t.time)," to ",displayTime(a.time)]}),(0,m.jsxs)("h5",{className:"mb-3",children:["You have spent ",displayMoney(10)," on upkeep"]}),0===a.devastations.length?(0,m.jsx)("h5",{className:"mb-3",children:"No Disasters Have Occurred!"}):(0,m.jsxs)(m.Fragment,{children:[(0,m.jsxs)("h5",{className:"mb-3",children:["Total Disasters: ",a.devastations.length]}),(0,m.jsxs)("h5",{className:"mb-3",children:[i.length," hit in your regions"]}),i.map(e=>(0,m.jsx)("p",{children:(0,m.jsx)(disaster_entry,{disaster:e,state:a})})),(0,m.jsxs)("h5",{className:"mb-3",children:[c.length," hit in other regions"]}),c.map(e=>(0,m.jsx)("p",{children:(0,m.jsx)(disaster_entry,{disaster:e,state:a,nameForPlayer:o})}))]})]})};a(8267);var game_over=e=>{let{state:t,gameContext:a,socketContext:r}=e,{nameForPlayer:n}=a,{myRoles:o}=r,l=t.players.filter(e=>e.regions_owned>0);return(0,m.jsxs)(m.Fragment,{children:[(0,m.jsxs)("h4",{className:"mb-4",children:["Total Remaining Players: ",l.length]}),(0,m.jsx)(b.Z,{className:"row-cols-1 g-3",children:Y()(t.players,e=>!o.includes(e.player_id)).map(e=>e.regions_owned>0?(0,m.jsxs)(m.Fragment,{children:[(0,m.jsxs)(x.Z,{children:[n(e.player_id)," had ",displayMoney(e.money)," and"," ",e.regions_owned," remaining region(s)"]}),Object.values(t.world.regions).filter(t=>t.current_player===e.player_id).map((e,t)=>(0,m.jsxs)(x.Z,{className:"ms-4",children:[e.name," (",e.biome,ea.biome[e.biome].emoji,", ",e.health,"❤️)"]},t))]}):(0,m.jsxs)(x.Z,{children:[n(e.player_id)," had ",e.regions_owned," remaining regions"]}))})]})};let displayTime=e=>2050+10*e,displayMoney=e=>"$".concat(e,"M"),et=(0,d.createContext)(void 0),ea={...V,biome:Q()(V.biomes,e=>e.name),disaster:Q()(V.disasters,e=>e.name)};var game=()=>{let e=(0,d.useContext)(I),{socket:t,currentRoom:a,roleInfo:r,myRoles:n}=e,[o,l]=(0,d.useState)(void 0),[i,h]=(0,d.useState)([]),[u,x]=(0,d.useState)(!1),[p,j]=(0,d.useState)(-1),[g,y]=(0,C.Z)([]),[_,v]=(0,C.Z)([]),[N,Z]=(0,d.useState)(void 0),[b,f]=(0,d.useState)(c.ByOwner),E=(0,d.useMemo)(()=>a&&r?r.map((e,t)=>{var r;return(null===(r=a.players.find(e=>e.roles.includes(t)))||void 0===r?void 0:r.name)||"Unknown"}):[],[a,r]),w=p<0||!o?void 0:o.world.regions[p],F=null==o?void 0:o.players[null==o?void 0:o.current_player],k=!!o&&n.includes(o.current_player),nameForPlayer=e=>{var t;return e<0?"Nobody":"".concat(null==r?void 0:null===(t=r[e])||void 0===t?void 0:t.name," (").concat(E[e],")")},[O]=(0,W.Z)("/earth-health-game/audio/EarthHealthTurnStart.mp3"),A=(0,D.Z)(o);(0,d.useEffect)(()=>{o&&(null==A?void 0:A.current_player)!==o.current_player&&n.includes(o.current_player)&&O(),o&&A&&o.time!==A.time&&y.push(o.time<o.final_turn?(0,m.jsx)(transition,{prevState:A,newState:o,gameContext:R,socketContext:e}):(0,m.jsx)(game_over,{state:o,gameContext:R,socketContext:e}))},[o,n]),(0,d.useEffect)(()=>{t&&(t.on("game_started",e=>{e.state&&(x(!1),l(JSON.parse(e.state)),_.push({time:0,message:"The game has started!"}))}),t.on("operators_available",e=>{h(e.operators)}),t.on("operator_applied",e=>{e.state&&l(t=>{var a,r;Z({...e.operator,player:null!==(a=null==t?void 0:t.current_player)&&void 0!==a?a:0,time:null!==(r=null==t?void 0:t.time)&&void 0!==r?r:0});let n=JSON.parse(e.state);return v.push(...logsForTransitions(t,n)),n})}),t.on("transition",e=>{let{message:t}=e}),t.on("game_ended",()=>{x(!0)}),t.on("disconnect",()=>{o&&(alert("You have been disconnected from the server"),window.location.reload())}),t.on("room_left",e=>{let{username:t}=e;o&&(x(!0),y.push("".concat(t," has left the game! Reconnection has not yet been implemented, so unfortunately the game must end.")))}))},[t]),(0,d.useEffect)(()=>{N&&v.push({time:N.time,message:logMessageForOperator(N,nameForPlayer(N.player),o)})},[N]),(0,d.useEffect)(()=>{a||l(void 0)},[a]);let R={state:o,operators:i,namesByRole:E,selectedRegion:p,setSelectedRegion:j,currentRegion:w,currentPlayer:F,myTurn:k,nameForPlayer,gameOver:u,options:{colorMode:b,setColorMode:f}};return(0,m.jsx)("div",{className:"h-auto user-select-none",children:o&&(0,m.jsx)(et.Provider,{value:R,children:(0,m.jsxs)("div",{className:"overflow-hidden position-relative d-flex",children:[(0,m.jsx)(game_map,{}),(0,m.jsxs)("div",{className:"position-absolute w-100 h-100 pointer-events-none",children:[(0,m.jsx)(state_info_panel,{className:"position-absolute top-0 start-0 m-4"}),(0,m.jsx)(selected_region_panel,{className:"position-absolute top-0 end-0 m-4"}),(0,m.jsx)(end_turn_panel,{className:"position-absolute bottom-0 end-0 m-4"}),(0,m.jsx)(visual_options_panel,{className:"position-absolute bottom-0 start-0 m-4"}),(0,m.jsx)(game_log_panel,{className:"position-absolute bottom-0 absolute-centered-x m-4",gameLogs:_}),(0,m.jsx)(menu_panel,{className:"position-absolute top-0 absolute-centered-x m-4"}),(0,m.jsx)(transitions_model,{body:g.length>0?g[0]:void 0,title:u?"Game Over!":"Transition",onHide:()=>{y.removeAt(0)}})]})]})})})},pages=()=>(0,m.jsx)(m.Fragment,{children:(0,m.jsx)(SocketIOCommon,{title:"Collaborative Climate Contest",children:(0,m.jsx)(game,{})})})}},function(e){e.O(0,[774,662,96,888,179],function(){return e(e.s=8312)}),_N_E=e.O()}]);