(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[405],{8312:function(e,t,s){(window.__NEXT_P=window.__NEXT_P||[]).push(["/",function(){return s(1005)}])},1005:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return pages}});var r,n,o,a,l,i,c=s(5893),d=s(7294),m=s(5005),h=s(1555),u=s(682),x=s(8345),p=s(4490),j=s(2749),g=s(4486),N=s(2914),C=s(4051),F=s(2599),Z=s(3907),f=s(4741),v=s(5472),E=s.n(v);let _=(0,d.createContext)({url:"http://localhost:5000",isConnected:!1}),createSocket=e=>(0,F.io)(e),SocketIOCommon=e=>{let{children:t}=e,[s,r]=(0,d.useState)("http://localhost:5000"),[n,o]=(0,d.useState)(()=>createSocket(s)),[a,l]=(0,d.useState)(!1),[i,F]=(0,Z.Z)("username","Client"),[v,y]=(0,f.Z)(new Set([0,1,2,3])),[S,k]=(0,d.useState)(!1);return(0,d.useEffect)(()=>(n.on("connect",()=>{l(!0),console.log("Client Connected")}),n.on("disconnect",()=>{l(!1),console.log("Client Disconnected")}),n.onAny((e,t)=>{console.log(e,t)}),n.on("game_started",()=>{k(!0)}),()=>{n.disconnect(),n.close()}),[n]),(0,c.jsxs)(c.Fragment,{children:[S||(0,c.jsx)(u.Z,{children:(0,c.jsxs)(C.Z,{className:"align-items-center m-2",children:[(0,c.jsxs)(h.Z,{md:4,children:[(0,c.jsx)(N.Z.Label,{children:"Server URL"}),(0,c.jsxs)("div",{className:"position-relative",children:[(0,c.jsx)(N.Z.Control,{type:"text",placeholder:"Enter server URL",value:s,onChange:e=>r(e.target.value)}),(0,c.jsx)("div",{})]})]}),(0,c.jsxs)(h.Z,{md:2,children:[(0,c.jsx)(N.Z.Label,{children:"Username"}),(0,c.jsx)(N.Z.Control,{type:"text",placeholder:"Enter username",value:i,onChange:e=>F(e.target.value)})]}),(0,c.jsxs)(h.Z,{md:1,children:[(0,c.jsx)(N.Z.Label,{children:"Roles"}),(0,c.jsxs)(x.Z,{children:[(0,c.jsx)(g.Z,{children:E()([...v],e=>e).join(" ")}),(0,c.jsx)(j.Z,{className:"py-0",children:[0,1,2,3].map(e=>(0,c.jsxs)(p.Z,{active:y.has(e),className:"my-2 rounded-2",onClick:()=>y.has(e)?y.remove(e):y.add(e),children:["Player ",e]},e))})]})]}),(0,c.jsxs)(h.Z,{md:5,children:[(0,c.jsx)(N.Z.Label,{children:"Actions"}),(0,c.jsxs)(C.Z,{children:[(0,c.jsx)(h.Z,{children:(0,c.jsx)(m.Z,{className:"w-100",variant:"primary",onClick:()=>n.emit("create_room",{room:"room"}),children:"Create Room"})}),(0,c.jsx)(h.Z,{children:(0,c.jsx)(m.Z,{className:"w-100",variant:"primary",onClick:()=>{n.emit("join_room",{room:"room",username:i||null}),n.emit("set_roles",{roles:[...v]})},children:"Join Room"})}),(0,c.jsx)(h.Z,{children:(0,c.jsx)(m.Z,{className:"w-100",variant:"success",onClick:()=>n.emit("start_game",{}),children:"Start Game"})})]})]})]})}),(0,c.jsx)(_.Provider,{value:{socket:n,url:s,isConnected:a},children:t})]})};var y=s(956),S=s(7172);(r=a||(a={})).OCEAN="Ocean",r.MOUNTAIN="Mountain",r.PLAINS="Plains",r.WOODS="Woods",r.MESA="Mesa",(n=l||(l={})).EARTHQUAKE="Earthquake",n.FIRE="Fire",n.FLOOD="Flood",n.WINDSTORM="Windstorm",(o=i||(i={})).RED="#C0392B",o.GREEN="#27AE60",o.YELLOW="#F1C40F",o.BLUE="#2980B9",o.MAGENTA="#8E44AD",o.CYAN="#16A085",o.WHITE="#ECF0F1";let k={[a.MESA]:"#C0392B",[a.MOUNTAIN]:"#16A085",[a.OCEAN]:"#2980B9",[a.PLAINS]:"#F1C40F",[a.WOODS]:"#27AE60"};l.EARTHQUAKE,l.FIRE,l.FLOOD,l.WINDSTORM;var A=s(4410),O=s(7042),w=s(6486),b=s.n(w),game=()=>{let{socket:e,url:t,isConnected:s}=(0,d.useContext)(_),[r,n]=(0,d.useState)([0,1,2,3]),[o,l]=(0,d.useState)(!1),[i,x]=(0,d.useState)(void 0),[p,j]=(0,d.useState)([]),[g,N]=(0,d.useState)(["Client","Client","Client","Client"]);(0,d.useEffect)(()=>{if(e)return e.on("game_started",e=>{e.state&&(l(!0),x(JSON.parse(e.state)))}),e.on("operators_available",e=>{j(e.operators)}),e.on("operator_applied",e=>{e.state&&x(JSON.parse(e.state))}),()=>{e.off("game_started"),e.off("operators_available"),e.off("operator_applied")}},[e]),i&&r.includes(i.current_player);let F=(0,d.useMemo)(()=>null==i?void 0:i.current_region,[i]),regionFromGeo=e=>{let t=parseInt(e.rsmKey.replace("geo-","")),s=i.world.map[t];return i.world.regions[s]};return(0,c.jsx)(u.Z,{className:"h-auto",children:i&&(0,c.jsx)("div",{className:"m-2",children:(0,c.jsxs)(y.Z,{className:"rounded-4 overflow-hidden position-relative",children:[(0,c.jsx)(S.ComposableMap,{width:800,height:600,style:{background:k[a.OCEAN]},onClick:()=>{},children:(0,c.jsx)(S.ZoomableGroup,{center:[0,0],zoom:2,minZoom:1.5,translateExtent:[[0,-600],[800,600]],children:(0,c.jsx)(S.Geographies,{geography:"/earth-health-game/map.geo.json",children:e=>{let{geographies:t}=e,s=b().chain(t).filter((e,t)=>t<i.world.region_count).orderBy(e=>regionFromGeo(e).name===F).value();return s.map(e=>{let t=regionFromGeo(e),s=k[t.region_type._value_];t.health<=0&&(s="#666");let r=F===t.name;return(0,c.jsx)(S.Geography,{geography:e,fill:s,style:{default:{stroke:r?"#FFF":"#666",strokeWidth:1,outline:"none"},hover:{stroke:r?"#FFF":"#666",strokeWidth:1,fill:(0,O.ZP)(s,"#FFF")(.2),outline:"none"}},onClick:e=>{e.stopPropagation()}},t.name)}).concat(s.map(e=>{let t=regionFromGeo(e),s=(0,A.Z)(e);return(0,c.jsxs)(S.Marker,{coordinates:s,className:"pointer-events-none",children:[(0,c.jsx)("circle",{r:.5,fill:"#FF5533",stroke:"#FFFFFF",strokeWidth:2}),(0,c.jsx)("text",{textAnchor:"middle",y:-2,style:{fontFamily:"system-ui",fontWeight:"bold",fontSize:5,fill:"#000"},stroke:"#FFF",strokeWidth:.2,children:t.name}),(0,c.jsx)("text",{textAnchor:"middle",y:4,style:{fontSize:3,letterSpacing:-.3},children:(0,w.repeat)("❤️",t.health)})]},e.rsmKey)}))}})})}),(0,c.jsxs)("div",{className:"position-absolute w-100 h-100 pointer-events-none",children:[(0,c.jsxs)(y.Z,{className:"position-absolute shadow-lg w-25 ms-4 mt-4 p-3",children:[(0,c.jsx)("h3",{className:"text-center",children:"Player Info"}),(0,c.jsx)(C.Z,{className:"row-cols-1 g-2",children:i.players.map((e,t)=>(0,c.jsxs)(h.Z,{children:["Player ",t," (",g[t],"): $",e.money,"M"]},t))})]}),(0,c.jsx)(y.Z,{className:"position-absolute shadow-lg w-25 mt-4 me-4 p-3 end-0",children:(0,c.jsxs)("h3",{className:"text-center",children:["Player ",i.current_player," (",g[i.current_player],") choosing for"," ",(0,c.jsx)("u",{children:i.current_region})]})}),(0,c.jsxs)(y.Z,{className:"position-absolute absolute-centered-x bottom-0 mb-4 shadow-lg w-auto p-3 ",children:[(0,c.jsx)("h3",{className:"text-center",children:p.length>0?"Operators":"Waiting for Others"}),(0,c.jsx)(C.Z,{className:"row-cols-1 g-2 mb-2  pointer-events-auto",children:p.map(t=>{let{op_no:s,name:r}=t;return(0,c.jsx)(h.Z,{className:"d-flex justify-content-center",children:(0,c.jsxs)(m.Z,{onClick:()=>e.emit("operator_chosen",{op_no:s,params:null}),children:["(",s,") ",r]})},s)})})]})]})]})})})},pages=()=>(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)("h1",{className:"text-center m-2",children:"Collaborative Climate Conquest"}),(0,c.jsx)(SocketIOCommon,{children:(0,c.jsx)(game,{})})]})}},function(e){e.O(0,[662,368,774,888,179],function(){return e(e.s=8312)}),_N_E=e.O()}]);